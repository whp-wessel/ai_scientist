{"files":[{"path":"analysis/code/derive_csa_indicator.py","content":"#!/usr/bin/env python3\n\"\"\"\nDerive a binary CSA exposure indicator and validate its distribution with suppression.\n\nRegeneration example:\npython analysis/code/derive_csa_indicator.py \\\n    --dataset data/raw/childhoodbalancedpublic_original.csv \\\n    --out-dataset data/clean/childhoodbalancedpublic_with_csa_indicator.csv \\\n    --out-distribution tables/csa_indicator_distribution.csv \\\n    --config config/agent_config.yaml \\\n    --codebook-in docs/codebook.json \\\n    --codebook-out docs/codebook.json\n\"\"\"\n\nfrom __future__ import annotations\n\nimport argparse\nimport json\nimport random\nfrom datetime import datetime, timezone\nfrom pathlib import Path\nfrom typing import Dict, Tuple\n\nimport numpy as np\nimport pandas as pd\nimport yaml\n\n\ndef parse_args() -> argparse.Namespace:\n    parser = argparse.ArgumentParser(\n        description=\"Create CSA exposure indicator (CSA_score > 0) and distribution table.\"\n    )\n    parser.add_argument(\"--dataset\", required=True, help=\"Input CSV dataset path.\")\n    parser.add_argument(\n        \"--out-dataset\",\n        required=True,\n        help=\"Destination CSV for dataset with CSA_score_indicator.\",\n    )\n    parser.add_argument(\n        \"--out-distribution\",\n        required=True,\n        help=\"Destination CSV summarising CSA_score_indicator distribution.\",\n    )\n    parser.add_argument(\"--config\", required=True, help=\"Path to agent_config.yaml.\")\n    parser.add_argument(\n        \"--codebook-in\",\n        required=True,\n        help=\"Input codebook JSON file to extend with indicator metadata.\",\n    )\n    parser.add_argument(\n        \"--codebook-out\",\n        required=True,\n        help=\"Output codebook JSON file including indicator metadata.\",\n    )\n    return parser.parse_args()\n\n\ndef load_config(path: Path) -> Tuple[int, int]:\n    config = yaml.safe_load(path.read_text())\n    seed = int(config.get(\"seed\", 0))\n    threshold = int(config.get(\"small_cell_threshold\", 10))\n    return seed, threshold\n\n\ndef suppress_count(count: int, threshold: int, total: int) -> Tuple[str, str, str]:\n    if count == 0 or count >= threshold:\n        pct = f\"{(count / total) * 100:.2f}%\"\n        return str(count), pct, \"ok\"\n    upper_pct = (threshold / total) * 100\n    return f\"<{threshold}\", f\"<{upper_pct:.2f}%\", \"suppressed\"\n\n\ndef enrich_codebook(\n    codebook_path: Path,\n    output_path: Path,\n    indicator_stats: Dict[str, float],\n    seed: int,\n) -> None:\n    codebook = json.loads(codebook_path.read_text())\n    variables = codebook.setdefault(\"variables\", [])\n    existing = {entry.get(\"name\"): entry for entry in variables}\n\n    indicator_entry = existing.get(\"CSA_score_indicator\")\n    summary_stats = {\n        \"count\": float(indicator_stats[\"count\"]),\n        \"mean\": float(indicator_stats[\"mean\"]),\n        \"std\": float(indicator_stats[\"std\"]),\n        \"min\": float(indicator_stats[\"min\"]),\n        \"q1\": float(indicator_stats[\"q1\"]),\n        \"median\": float(indicator_stats[\"median\"]),\n        \"q3\": float(indicator_stats[\"q3\"]),\n        \"max\": float(indicator_stats[\"max\"]),\n        \"n_missing\": int(indicator_stats[\"n_missing\"]),\n        \"unique\": int(indicator_stats[\"unique\"]),\n    }\n\n    note = (\n        f\"Binary indicator derived {datetime.now(timezone.utc).isoformat()} | \"\n        f\"Seed {seed} | Source analysis/code/derive_csa_indicator.py (CSA_score > 0).\"\n    )\n\n    if indicator_entry is None:\n        variables.append(\n            {\n                \"name\": \"CSA_score_indicator\",\n                \"label\": \"Any childhood sexual abuse exposure (CSA_score>0)\",\n                \"question_text\": None,\n                \"analysis_role\": \"predictor\",\n                \"type\": \"binary\",\n                \"storage\": \"float64\",\n                \"allowed_values\": [0, 1],\n                \"value_labels\": {\"0\": \"No reported exposure\", \"1\": \"Reported exposure\"},\n                \"missing_codes\": [],\n                \"summary_stats\": summary_stats,\n                \"notes\": note,\n            }\n        )\n    else:\n        indicator_entry.update(\n            {\n                \"label\": \"Any childhood sexual abuse exposure (CSA_score>0)\",\n                \"analysis_role\": \"predictor\",\n                \"type\": \"binary\",\n                \"storage\": \"float64\",\n                \"allowed_values\": [0, 1],\n                \"value_labels\": {\n                    \"0\": \"No reported exposure\",\n                    \"1\": \"Reported exposure\",\n                },\n                \"missing_codes\": [],\n                \"summary_stats\": summary_stats,\n                \"notes\": note,\n            }\n        )\n\n    previous_regeneration = codebook.get(\"regeneration\")\n    codebook[\"regeneration\"] = {\n        \"command\": (\n            \"python analysis/code/derive_csa_indicator.py \"\n            \"--dataset data/raw/childhoodbalancedpublic_original.csv \"\n            \"--out-dataset data/clean/childhoodbalancedpublic_with_csa_indicator.csv \"\n            \"--out-distribution tables/csa_indicator_distribution.csv \"\n            \"--config config/agent_config.yaml \"\n            \"--codebook-in docs/codebook.json \"\n            \"--codebook-out docs/codebook.json\"\n        ),\n        \"seed\": seed,\n        \"created_by\": \"analysis/code/derive_csa_indicator.py\",\n    }\n    if previous_regeneration:\n        history = codebook.setdefault(\"regeneration_history\", [])\n        history.append(previous_regeneration)\n\n    output_path.write_text(json.dumps(codebook, indent=2))\n\n\ndef main() -> None:\n    args = parse_args()\n\n    dataset_path = Path(args.dataset)\n    out_dataset_path = Path(args.out_dataset)\n    out_distribution_path = Path(args.out_distribution)\n    config_path = Path(args.config)\n    codebook_in_path = Path(args.codebook_in)\n    codebook_out_path = Path(args.codebook_out)\n\n    seed, threshold = load_config(config_path)\n    random.seed(seed)\n    np.random.seed(seed)\n\n    df = pd.read_csv(dataset_path, low_memory=False)\n    if \"CSA_score\" not in df.columns:\n        raise ValueError(\"CSA_score column missing from dataset.\")\n\n    indicator = np.where(\n        df[\"CSA_score\"].notna(), (df[\"CSA_score\"] > 0).astype(float), np.nan\n    )\n    df[\"CSA_score_indicator\"] = indicator\n\n    out_dataset_path.parent.mkdir(parents=True, exist_ok=True)\n    df.to_csv(out_dataset_path, index=False)\n\n    total = int(df.shape[0])\n    counts = df[\"CSA_score_indicator\"].value_counts(dropna=False).sort_index()\n    distribution_rows = []\n    for level, count in counts.items():\n        if pd.isna(level):\n            level_label = \"NaN\"\n        else:\n            level_label = int(level)\n        display_count, percent, status = (\n            (\"N/A\", \"N/A\", \"missing\")\n            if pd.isna(level)\n            else suppress_count(int(count), threshold, total)\n        )\n        distribution_rows.append(\n            {\n                \"CSA_score_indicator\": level_label,\n                \"count\": display_count,\n                \"percent\": percent,\n                \"status\": status,\n            }\n        )\n\n    out_distribution_path.parent.mkdir(parents=True, exist_ok=True)\n    pd.DataFrame(distribution_rows).to_csv(out_distribution_path, index=False)\n\n    series = df[\"CSA_score_indicator\"]\n    indicator_stats = {\n        \"count\": float(series.count()),\n        \"mean\": float(series.mean(skipna=True)),\n        \"std\": float(series.std(skipna=True)),\n        \"min\": float(series.min(skipna=True)),\n        \"q1\": float(series.quantile(0.25)),\n        \"median\": float(series.median(skipna=True)),\n        \"q3\": float(series.quantile(0.75)),\n        \"max\": float(series.max(skipna=True)),\n        \"n_missing\": int(series.isna().sum()),\n        \"unique\": int(series.nunique(dropna=True)),\n    }\n\n    enrich_codebook(codebook_in_path, codebook_out_path, indicator_stats, seed)\n\n\nif __name__ == \"__main__\":\n    main()\n","mode":"text"},{"path":"analysis/hypotheses.csv","content":"id,family,description,outcome_var,predictors,controls,population/subset,estimand,status,notes\nHYP-001,Wellbeing,\"Childhood class positively relates to adult self-love.\",I love myself (2l8994l),classchild,\"selfage; gendermale\",\"Non-missing classchild & outcome\",\"Weighted mean change per class unit\",selected,\"Primary model: survey OLS (HC3). Robustness: (1) treat classchild as categorical with Helmert contrasts; (2) ordinal logit with proportional odds check; (3) re-center outcome to z-score for scale sensitivity.\"\nHYP-002,MentalHealth,\"Current class inversely relates to depression agreement.\",I tend to suffer from depression (wz901dj),classcurrent,\"selfage; gendermale; cis\",\"Non-missing classcurrent & outcome\",\"Weighted coefficient on classcurrent\",proposed,\"Spline robustness.\"\nHYP-003,MentalHealth,\"CSA exposure associates with higher anxiety agreement.\",I tend to suffer from anxiety (npvfh98)-neg,CSA_score_indicator,\"selfage; gendermale\",\"Observed CSA_score\",\"Weighted mean difference (CSA>0 vs 0)\",selected,\"CSA_score_indicator derived via analysis/code/derive_csa_indicator.py (CSA_score>0). Robustness: (1) logistic regression (logit) on indicator vs linear probability; (2) replace indicator with 3-level ordinal bins (0, 1-3, 4+); (3) exclude high-exposure tail (CSA>15) to test leverage.\"\nHYP-004,SocialSupport,\"Supportive circles associate with higher self-love.\",I love myself (2l8994l),\"In general, people in my *current* social circles tend treat me really well (tmt46e6)\",\"selfage; gendermale\",\"Non-missing support & outcome\",\"Weighted coefficient on support\",proposed,\"Ordinal logit robustness.\"\n","mode":"text"},{"path":"analysis/pre_analysis_plan.md","content":"# PAP Draft\nGenerated: 2025-11-03T21:05:45Z | Seed: 20251016\nStatus: Draft (not frozen) | Regen: `python analysis/code/bootstrap_setup.py --artifact analysis/pre_analysis_plan.md`\n\nData inputs:\n- Raw: `data/raw/childhoodbalancedpublic_original.csv`\n- Clean (derived): `data/clean/childhoodbalancedpublic_with_csa_indicator.csv` via `python analysis/code/derive_csa_indicator.py --dataset data/raw/childhoodbalancedpublic_original.csv --out-dataset data/clean/childhoodbalancedpublic_with_csa_indicator.csv --out-distribution tables/csa_indicator_distribution.csv --config config/agent_config.yaml --codebook-in docs/codebook.json --codebook-out docs/codebook.json`\n\nPortfolio: HYP-001 (High), HYP-002 (Medium), HYP-003 (High), HYP-004 (Medium)\n\n## HYP-001 \u2014 Childhood class and adult self-love\n- **Outcome**: `I love myself (2l8994l)` (Likert \u22123 to +3)  \n  **Predictor**: `classchild` (0\u20136 ordinal)  \n  **Covariates**: `selfage`, `gendermale`, `cis`\n- **Estimand**: Average change in outcome per one-step increase in childhood class (design-based OLS with HC3).\n- **Primary model**: `survey`-adjusted linear regression under SRS assumption (weights=1). Robust HC3 standard errors with seed 20251016.\n- **Robustness checks**:  \n  1. Treat `classchild` as categorical with Helmert contrasts (tests functional form).  \n  2. Fit proportional-odds ordinal logit on the outcome; assess Brant test to flag violations.  \n  3. Standardise outcome to z-score and refit OLS to confirm scale invariance.\n- **Missing-data plan**: If any covariate missingness >5%, execute multiple imputation (m=5, deterministic seed 20251016) before confirmatory analysis; otherwise listwise deletion.\n\n## HYP-003 \u2014 CSA exposure and anxiety agreement\n- **Outcome**: `I tend to suffer from anxiety (npvfh98)-neg`\n- **Predictor**: `CSA_score_indicator` (derived binary; 1 if CSA_score>0)\n- **Covariates**: `selfage`, `gendermale`, `classchild`\n- **Estimand**: Difference in mean anxiety agreement between any CSA exposure vs none.\n- **Primary model**: OLS with HC3 under SRS, plus design-based two-sample comparison (Welch t using survey variance) to confirm direction/scale.\n- **Robustness checks**:  \n  1. Logistic regression on `CSA_score_indicator` predicting high anxiety (>=1) to examine non-linear probability scale.  \n  2. Replace binary predictor with ordinal bins `{0, 1-3, 4+}` and test linear trend.  \n  3. Exclude extreme tail (`CSA_score` > 15) to assess leverage sensitivity.\n- **Missing-data plan**: Monitor derived indicator (currently 0% missing). If downstream models require additional variables with >5% missingness, extend MI plan above; record seeds.\n\nRoadmap: 1) Finalize survey design assumptions and document SRS rationale. 2) Label exploratory descriptives (clearly marked). 3) Update PAP with model equations + estimators, freeze, and tag git. 4) Execute confirmatory models, log seeds to `analysis/results.csv`, and mirror updates in `papers/main/MANIFEST.md`.\n\nManuscript parity: update `reports/findings_v0.1.md` and `papers/main/manuscript.tex` in lockstep; record regeneration commands alongside outputs.\n","mode":"text"},{"path":"qc/data_checks.md","content":"# QC Checklist\nGenerated: 2025-11-03T21:05:45Z | Seed: 20251016\nRegeneration:\n- `python analysis/code/bootstrap_setup.py --artifact qc/data_checks.md` (scaffold)\n- `python analysis/code/profile_missingness.py --dataset childhoodbalancedpublic_original.csv --codebook docs/codebook.json --hypotheses analysis/hypotheses.csv --config config/agent_config.yaml --out-csv tables/missingness_profile.csv --out-patterns tables/missingness_patterns.csv`\n- `python analysis/code/derive_csa_indicator.py --dataset data/raw/childhoodbalancedpublic_original.csv --out-dataset data/clean/childhoodbalancedpublic_with_csa_indicator.csv --out-distribution tables/csa_indicator_distribution.csv --config config/agent_config.yaml --codebook-in docs/codebook.json --codebook-out docs/codebook.json`\n- `cat tables/missingness_profile.meta.json` (metadata)\n\n- [x] Dataset present (read-only).\n- [x] Align schema with codebook (see `qc/schema_alignment.md`).\n- [x] Confirm weight/strata/cluster variables (see `qc/survey_design_validation.md`).\n- [x] Summarise missingness for key variables (outputs suppressed where n<10).\n- [x] Ensure no small cells (n<10) in shared outputs.\n- [x] Validate CSA indicator distribution (`tables/csa_indicator_distribution.csv`).\n\nNotes:\n- High item nonresponse (97.35%) for social support predictor `In general, people in my *current* social circles tend treat me really well (tmt46e6)`; confirm suitability before PAP freeze.\n- `CSA_score_indicator` derived from `CSA_score` (>0) via reproducible script; distribution reviewed (no suppressed cells).\n","mode":"text"},{"path":"notebooks/research_notebook.md","content":"# Research Notebook\nUpdated: 2025-11-03T21:05:45Z | Seed: 20251016\n\nReproducibility: run `python analysis/code/bootstrap_setup.py`; env info in `artifacts/session_info.txt`; checksums in `artifacts/checksums.json`.\n\nHypotheses: HYP-001 childhood class \u2191 self-love; HYP-002 current class \u2193 depression; HYP-003 CSA \u2191 anxiety; HYP-004 support \u2191 self-love.\n\n2025-11-03T20:29Z \u2014 Survey design validation confirms no sampling weights/strata/clusters present in `childhoodbalancedpublic_original.csv`; working under simple random sampling assumption. See `qc/survey_design_validation.md` regenerated via `python analysis/code/validate_survey_design.py`.\n\n2025-11-03T20:34Z (Exploratory) \u2014 Generated outcome distributions under SRS assumption via\\\n `python analysis/code/eda_weighted_summaries.py --dataset childhoodbalancedpublic_original.csv --codebook docs/codebook.json --config config/agent_config.yaml --out-summary tables/exploratory_outcome_summary.csv --out-distribution tables/exploratory_outcome_distribution.csv`.\\\n Key findings: self-love skews positive (median=1), while depression/anxiety skew negative (median -1). All categories exceed the small-cell threshold (10). Outputs: `tables/exploratory_outcome_summary.csv`, `tables/exploratory_outcome_distribution.csv`.\n\nTODO: document literature and exploratory findings (labelled \"Exploratory\"); derive CSA indicator prior to PAP freeze. Prepare `papers/main/MANIFEST.md` when manuscript drafting begins.\n\n2025-11-03T20:50Z \u2014 Schema alignment completed via \\\n`python analysis/code/align_codebook_schema.py --dataset childhoodbalancedpublic_original.csv --codebook-in docs/codebook.json --codebook-out docs/codebook.json`.\\\nValidated storage types, allowed ranges, and missingness for six analysis variables; suppressed small cells (<10) and now omit detailed frequency tables to avoid sparse tail disclosure. Details recorded in `qc/schema_alignment.md`.\n\n2025-11-03T20:56Z (QC) \u2014 Profiled hypothesis-relevant missingness via \\\n`python analysis/code/profile_missingness.py --dataset childhoodbalancedpublic_original.csv --codebook docs/codebook.json --hypotheses analysis/hypotheses.csv --config config/agent_config.yaml --out-csv tables/missingness_profile.csv --out-patterns tables/missingness_patterns.csv`.\\\n Suppressed cell counts <10; see `tables/missingness_profile.csv` (+ `.meta.json`) and `tables/missingness_patterns.csv`. Social support predictor `In general, people in my *current* social circles tend treat me really well (tmt46e6)` exhibits 97.35% missingness\u2014flagged for feasibility review. At that point `CSA_score_indicator` was absent in raw data, motivating derivation task T-006 prior to PAP freeze.\n\n2025-11-03T21:05Z (Derived) \u2014 Established canonical data folders (`data/raw`, `data/clean`) and derived CSA exposure indicator via \\\n`python analysis/code/derive_csa_indicator.py --dataset data/raw/childhoodbalancedpublic_original.csv --out-dataset data/clean/childhoodbalancedpublic_with_csa_indicator.csv --out-distribution tables/csa_indicator_distribution.csv --config config/agent_config.yaml --codebook-in docs/codebook.json --codebook-out docs/codebook.json`.\\\nOutput dataset stored at `data/clean/childhoodbalancedpublic_with_csa_indicator.csv`; distribution table `tables/csa_indicator_distribution.csv` confirms 22.31% report any CSA (no cells <10). Updated `docs/codebook.json` with new binary predictor metadata and refreshed `artifacts/checksums.json`. PAP robustness section expanded for HYP-001/HYP-003 (see `analysis/pre_analysis_plan.md`).\n","mode":"text"},{"path":"artifacts/state.json","content":"{\n  \"backlog\": [\n    {\n      \"description\": \"Validate survey weights and replicate design\",\n      \"id\": \"T-001\",\n      \"priority\": 1,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Exploratory weighted summaries for key outcomes\",\n      \"id\": \"T-002\",\n      \"priority\": 1,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Align codebook schema with dataset\",\n      \"id\": \"T-003\",\n      \"priority\": 2,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Profile missingness patterns for key variables\",\n      \"id\": \"T-004\",\n      \"priority\": 2,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Draft robustness checks for priority hypotheses\",\n      \"id\": \"T-005\",\n      \"priority\": 3,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Derive CSA_score_indicator and validate distribution\",\n      \"id\": \"T-006\",\n      \"priority\": 2,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Assess feasibility of social support predictor given 97% missingness\",\n      \"id\": \"T-007\",\n      \"priority\": 2,\n      \"status\": \"pending\"\n    },\n    {\n      \"description\": \"Draft confirmatory model equations/code skeleton for PAP freeze\",\n      \"id\": \"T-008\",\n      \"priority\": 3,\n      \"status\": \"pending\"\n    }\n  ],\n  \"bootstrap_complete\": true,\n  \"last_updated\": \"2025-11-03T21:06:06+00:00\",\n  \"loop_counter\": 5,\n  \"next_actions\": [\n    {\n      \"description\": \"Assess feasibility of social support predictor given 97% missingness\",\n      \"id\": \"T-007\",\n      \"priority\": 2\n    },\n    {\n      \"description\": \"Draft confirmatory model equations/code skeleton for PAP freeze\",\n      \"id\": \"T-008\",\n      \"priority\": 3\n    }\n  ],\n  \"notes\": \"CSA indicator derived and documented; next evaluate social support predictor feasibility and prepare confirmatory model skeleton before PAP freeze.\",\n  \"pap_status\": \"draft\",\n  \"priority_hypotheses\": [\n    \"HYP-001\",\n    \"HYP-003\"\n  ],\n  \"seed\": 20251016,\n  \"total_loops\": 30\n}","mode":"text"},{"path":"analysis/decision_log.csv","content":"ts,action,inputs,rationale_short,code_path,outputs,status\n2025-11-03T20:01:43Z,bootstrap,docs/codebook.json;docs/survey_design.yaml;config/agent_config.yaml,\"Initialized bootstrap scaffolding, hypotheses, PAP draft, and regen script.\",N/A,artifacts/state.json;analysis/hypotheses.csv;analysis/pre_analysis_plan.md,success\n2025-11-03T20:18:32Z,validate_design,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,\"Confirmed no survey weights; default to SRS.\",analysis/code/validate_survey_design.py,docs/survey_design.yaml;qc/survey_design_validation.md,success\n2025-11-03T20:23:05Z,regen_design,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,\"Regenerated design artifacts after script refactor.\",analysis/code/validate_survey_design.py,docs/survey_design.yaml;qc/survey_design_validation.md,success\n2025-11-03T20:24:59Z,regen_design,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,\"Refined validation script for leaner reproducibility footprint.\",analysis/code/validate_survey_design.py,docs/survey_design.yaml;qc/survey_design_validation.md,success\n2025-11-03T20:26:59Z,regen_design,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,\"Re-executed lean validation script to refresh artifacts.\",analysis/code/validate_survey_design.py,docs/survey_design.yaml;qc/survey_design_validation.md,success\n2025-11-03T20:29:10Z,regen_design,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,\"Compressed validation script and refreshed outputs.\",analysis/code/validate_survey_design.py,docs/survey_design.yaml;qc/survey_design_validation.md,success\n2025-11-03T20:29:10Z,regen_design,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,Compressed validation script and refreshed outputs.,analysis/code/validate_survey_design.py,docs/survey_design.yaml;qc/survey_design_validation.md,success\n2025-11-03T20:34:14Z,exploratory_summary,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,\"Generated exploratory outcome summaries under SRS.\",analysis/code/eda_weighted_summaries.py,tables/exploratory_outcome_summary.csv;tables/exploratory_outcome_distribution.csv,success\n2025-11-03T20:34:14Z,exploratory_summary,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,Generated exploratory outcome summaries under SRS.,analysis/code/eda_weighted_summaries.py,tables/exploratory_outcome_summary.csv;tables/exploratory_outcome_distribution.csv,success\n2025-11-03T20:44:20Z,schema_alignment,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,Regenerated codebook schema with suppressed small cells.,analysis/code/align_codebook_schema.py,docs/codebook.json;qc/schema_alignment.md,success\n2025-11-03T20:47:13Z,schema_alignment,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,Trimmed published frequencies to limit sparse tail disclosure.,analysis/code/align_codebook_schema.py,docs/codebook.json;qc/schema_alignment.md,success\n2025-11-03T20:48:21Z,schema_alignment,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,Refreshed codebook notes to current timestamp.,analysis/code/align_codebook_schema.py,docs/codebook.json;qc/schema_alignment.md,success\n2025-11-03T20:50:32Z,schema_alignment,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,Streamlined codebook to summary-only metadata for disclosure control.,analysis/code/align_codebook_schema.py,docs/codebook.json;qc/schema_alignment.md,success\n2025-11-03T20:50:32Z,schema_alignment,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,Streamlined codebook to summary-only metadata for disclosure control.,analysis/code/align_codebook_schema.py,docs/codebook.json;qc/schema_alignment.md,success\n2025-11-03T20:56:41Z,missingness_profile,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml;analysis/hypotheses.csv,\"Profiled hypothesis missingness; suppressed <10 cells.\",analysis/code/profile_missingness.py,tables/missingness_profile.csv;tables/missingness_patterns.csv;tables/missingness_profile.meta.json,success\n2025-11-03T20:56:41Z,missingness_profile,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml;analysis/hypotheses.csv,Profiled hypothesis missingness; suppressed <10 cells.,analysis/code/profile_missingness.py,tables/missingness_profile.csv;tables/missingness_patterns.csv;tables/missingness_profile.meta.json,success\n2025-11-03T21:06:24Z,derive_csa_indicator,data/raw/childhoodbalancedpublic_original.csv;config/agent_config.yaml;docs/codebook.json;analysis/pre_analysis_plan.md,Derived CSA indicator and expanded robustness plans.,analysis/code/derive_csa_indicator.py,data/clean/childhoodbalancedpublic_with_csa_indicator.csv;tables/csa_indicator_distribution.csv;docs/codebook.json;analysis/pre_analysis_plan.md;analysis/hypotheses.csv;notebooks/research_notebook.md;qc/data_checks.md,success\n","mode":"text"},{"path":"docs/codebook.json","content":"{\n  \"dataset\": \"childhoodbalancedpublic_original.csv\",\n  \"generated_at\": \"2025-11-03T20:50:32Z\",\n  \"row_count\": 14443,\n  \"column_count\": 718,\n  \"seed\": 20251016,\n  \"variables\": [\n    {\n      \"name\": \"classchild\",\n      \"label\": \"Childhood household class (hxyr6oa)\",\n      \"question_text\": null,\n      \"analysis_role\": \"predictor\",\n      \"type\": \"ordinal\",\n      \"storage\": \"float64\",\n      \"allowed_values\": [\n        0,\n        1,\n        2,\n        3,\n        4,\n        5,\n        6\n      ],\n      \"value_labels\": {\n        \"0\": \"Lower class\",\n        \"1\": \"Working class\",\n        \"2\": \"Lower middle class\",\n        \"3\": \"Middle class\",\n        \"4\": \"Upper middle class\",\n        \"5\": \"Upper class\",\n        \"6\": \"Upper upper class\"\n      },\n      \"missing_codes\": [],\n      \"summary_stats\": {\n        \"count\": 14443.0,\n        \"mean\": 2.620854393131621,\n        \"std\": 1.2755028567254565,\n        \"min\": 0.0,\n        \"q1\": 2.0,\n        \"median\": 3.0,\n        \"q3\": 4.0,\n        \"max\": 6.0,\n        \"n_missing\": 0,\n        \"unique\": 7\n      },\n      \"notes\": \"0-6 scale; labels TBD | Empirical alignment 2025-11-03T20:50:32Z\"\n    },\n    {\n      \"name\": \"classcurrent\",\n      \"label\": \"Current household class (m5tjvul)\",\n      \"question_text\": null,\n      \"analysis_role\": \"predictor\",\n      \"type\": \"ordinal\",\n      \"storage\": \"float64\",\n      \"allowed_values\": [\n        0,\n        1,\n        2,\n        3,\n        4,\n        5,\n        6\n      ],\n      \"value_labels\": {\n        \"0\": \"Lower class\",\n        \"1\": \"Working class\",\n        \"2\": \"Lower middle class\",\n        \"3\": \"Middle class\",\n        \"4\": \"Upper middle class\",\n        \"5\": \"Upper class\",\n        \"6\": \"Upper upper class\"\n      },\n      \"missing_codes\": [],\n      \"summary_stats\": {\n        \"count\": 14443.0,\n        \"mean\": 3.0222945371460224,\n        \"std\": 1.2589747379818785,\n        \"min\": 0.0,\n        \"q1\": 2.0,\n        \"median\": 3.0,\n        \"q3\": 4.0,\n        \"max\": 6.0,\n        \"n_missing\": 0,\n        \"unique\": 7\n      },\n      \"notes\": \"0-6 scale; labels TBD | Empirical alignment 2025-11-03T20:50:32Z\"\n    },\n    {\n      \"name\": \"I love myself (2l8994l)\",\n      \"label\": \"Self-love Likert\",\n      \"question_text\": null,\n      \"analysis_role\": \"outcome\",\n      \"type\": \"ordinal_-3_to_3\",\n      \"storage\": \"float64\",\n      \"allowed_values\": [\n        -3,\n        -2,\n        -1,\n        0,\n        1,\n        2,\n        3\n      ],\n      \"value_labels\": {\n        \"-3\": \"Strongly disagree\",\n        \"-2\": \"Disagree\",\n        \"-1\": \"Somewhat disagree\",\n        \"0\": \"Neutral\",\n        \"1\": \"Somewhat agree\",\n        \"2\": \"Agree\",\n        \"3\": \"Strongly agree\"\n      },\n      \"missing_codes\": [],\n      \"summary_stats\": {\n        \"count\": 14436.0,\n        \"mean\": 0.6131199778331948,\n        \"std\": 1.8621394200457027,\n        \"min\": -3.0,\n        \"q1\": -1.0,\n        \"median\": 1.0,\n        \"q3\": 2.0,\n        \"max\": 3.0,\n        \"n_missing\": 7,\n        \"unique\": 7\n      },\n      \"notes\": \"Empirical alignment 2025-11-03T20:50:32Z; confirm instrument labels.\"\n    },\n    {\n      \"name\": \"I tend to suffer from depression (wz901dj)\",\n      \"label\": \"Depression tendency\",\n      \"question_text\": null,\n      \"analysis_role\": \"outcome\",\n      \"type\": \"ordinal_-3_to_3\",\n      \"storage\": \"float64\",\n      \"allowed_values\": [\n        -3,\n        -2,\n        -1,\n        0,\n        1,\n        2,\n        3\n      ],\n      \"value_labels\": {\n        \"-3\": \"Strongly disagree\",\n        \"-2\": \"Disagree\",\n        \"-1\": \"Somewhat disagree\",\n        \"0\": \"Neutral\",\n        \"1\": \"Somewhat agree\",\n        \"2\": \"Agree\",\n        \"3\": \"Strongly agree\"\n      },\n      \"missing_codes\": [],\n      \"summary_stats\": {\n        \"count\": 14438.0,\n        \"mean\": -0.40739714641917163,\n        \"std\": 2.0893939180982533,\n        \"min\": -3.0,\n        \"q1\": -2.0,\n        \"median\": -1.0,\n        \"q3\": 2.0,\n        \"max\": 3.0,\n        \"n_missing\": 5,\n        \"unique\": 7\n      },\n      \"notes\": \"Empirical alignment 2025-11-03T20:50:32Z; confirm instrument labels.\"\n    },\n    {\n      \"name\": \"I tend to suffer from anxiety (npvfh98)-neg\",\n      \"label\": \"Anxiety tendency (neg-coded)\",\n      \"question_text\": null,\n      \"analysis_role\": \"outcome\",\n      \"type\": \"ordinal_-3_to_3\",\n      \"storage\": \"float64\",\n      \"allowed_values\": [\n        -3,\n        -2,\n        -1,\n        0,\n        1,\n        2,\n        3\n      ],\n      \"value_labels\": {\n        \"-3\": \"Strongly disagree\",\n        \"-2\": \"Disagree\",\n        \"-1\": \"Somewhat disagree\",\n        \"0\": \"Neutral\",\n        \"1\": \"Somewhat agree\",\n        \"2\": \"Agree\",\n        \"3\": \"Strongly agree\"\n      },\n      \"missing_codes\": [],\n      \"summary_stats\": {\n        \"count\": 14437.0,\n        \"mean\": -0.8274572279559466,\n        \"std\": 2.030987362624485,\n        \"min\": -3.0,\n        \"q1\": -3.0,\n        \"median\": -1.0,\n        \"q3\": 1.0,\n        \"max\": 3.0,\n        \"n_missing\": 6,\n        \"unique\": 7\n      },\n      \"notes\": \"Empirical alignment 2025-11-03T20:50:32Z; confirm instrument labels.\"\n    },\n    {\n      \"name\": \"CSA_score\",\n      \"label\": \"Childhood sexual abuse composite\",\n      \"question_text\": null,\n      \"analysis_role\": \"predictor\",\n      \"type\": \"count\",\n      \"storage\": \"float64\",\n      \"allowed_values\": [\n        0,\n        1,\n        2,\n        3,\n        4,\n        5,\n        6,\n        7,\n        8,\n        9,\n        10,\n        11,\n        12,\n        13,\n        14,\n        15,\n        16,\n        17,\n        18,\n        19,\n        20,\n        21,\n        22\n      ],\n      \"value_labels\": null,\n      \"missing_codes\": [],\n      \"summary_stats\": {\n        \"count\": 14443.0,\n        \"mean\": 1.0353804611230353,\n        \"std\": 2.7581371170064597,\n        \"min\": 0.0,\n        \"q1\": 0.0,\n        \"median\": 0.0,\n        \"q3\": 0.0,\n        \"max\": 22.0,\n        \"n_missing\": 0,\n        \"unique\": 23\n      },\n      \"notes\": \"0+; bins TBD | Empirical alignment 2025-11-03T20:50:32Z\"\n    },\n    {\n      \"name\": \"CSA_score_indicator\",\n      \"label\": \"Any childhood sexual abuse exposure (CSA_score>0)\",\n      \"question_text\": null,\n      \"analysis_role\": \"predictor\",\n      \"type\": \"binary\",\n      \"storage\": \"float64\",\n      \"allowed_values\": [\n        0,\n        1\n      ],\n      \"value_labels\": {\n        \"0\": \"No reported exposure\",\n        \"1\": \"Reported exposure\"\n      },\n      \"missing_codes\": [],\n      \"summary_stats\": {\n        \"count\": 14443.0,\n        \"mean\": 0.2230838468462231,\n        \"std\": 0.4163285301939064,\n        \"min\": 0.0,\n        \"q1\": 0.0,\n        \"median\": 0.0,\n        \"q3\": 0.0,\n        \"max\": 1.0,\n        \"n_missing\": 0,\n        \"unique\": 2\n      },\n      \"notes\": \"Binary indicator derived 2025-11-03T21:04:00.464315+00:00 | Seed 20251016 | Source analysis/code/derive_csa_indicator.py (CSA_score > 0).\"\n    }\n  ],\n  \"weights_reference\": \"docs/survey_design.yaml\",\n  \"regeneration\": {\n    \"command\": \"python analysis/code/derive_csa_indicator.py --dataset data/raw/childhoodbalancedpublic_original.csv --out-dataset data/clean/childhoodbalancedpublic_with_csa_indicator.csv --out-distribution tables/csa_indicator_distribution.csv --config config/agent_config.yaml --codebook-in docs/codebook.json --codebook-out docs/codebook.json\",\n    \"seed\": 20251016,\n    \"created_by\": \"analysis/code/derive_csa_indicator.py\"\n  },\n  \"notes\": \"Schema aligned with observed dataset on 2025-11-03T20:50:32Z; verify value labels with source instrument.\",\n  \"regeneration_history\": [\n    {\n      \"command\": \"python analysis/code/align_codebook_schema.py --dataset childhoodbalancedpublic_original.csv --codebook-in docs/codebook.json --codebook-out docs/codebook.json\",\n      \"seed\": 20251016,\n      \"created_by\": \"analysis/code/align_codebook_schema.py\"\n    }\n  ]\n}","mode":"text"},{"path":"tables/csa_indicator_distribution.csv","content":"CSA_score_indicator,count,percent,status\n0,11221,77.69%,ok\n1,3222,22.31%,ok\n","mode":"text"},{"path":"artifacts/checksums.json","content":"[\n  {\n    \"path\": \"childhoodbalancedpublic_original.csv\",\n    \"sha256\": \"811681051039f470268aac4e5a94bcf1a325a9d60d644e08b98ba97c74c3e222\"\n  },\n  {\n    \"path\": \"data/raw/childhoodbalancedpublic_original.csv\",\n    \"sha256\": \"811681051039f470268aac4e5a94bcf1a325a9d60d644e08b98ba97c74c3e222\"\n  },\n  {\n    \"path\": \"data/clean/childhoodbalancedpublic_with_csa_indicator.csv\",\n    \"sha256\": \"b48fd2f7f0ad91ef6bd9248558ffca9ccd604dab5defa2c24524b94b91998307\"\n  }\n]","mode":"text"}],"decision_log_row":{"ts":"2025-11-03T21:06:24Z","action":"derive_csa_indicator","inputs":["data/raw/childhoodbalancedpublic_original.csv","config/agent_config.yaml","docs/codebook.json","analysis/pre_analysis_plan.md"],"rationale_short":"Derived CSA indicator and expanded robustness plans.","code_path":"analysis/code/derive_csa_indicator.py","outputs":["data/clean/childhoodbalancedpublic_with_csa_indicator.csv","tables/csa_indicator_distribution.csv","docs/codebook.json","analysis/pre_analysis_plan.md","analysis/hypotheses.csv","notebooks/research_notebook.md","qc/data_checks.md"],"status":"success"},"next_actions":[{"id":"T-007","priority":2,"desc":"Assess feasibility of social support predictor given 97% missingness","estimate_min":"25m"},{"id":"T-008","priority":3,"desc":"Draft confirmatory model equations/code skeleton for PAP freeze","estimate_min":"30m"}],"state_update":{"loop_counter":5},"git":{"commit":true,"message":"feat(analysis): derive CSA indicator and expand robustness plan"},"stop_now":false,"stop_reason":"","signals":[]}