{"files": [{"path": "analysis/code/review_anxiety_instrument.py", "content": "#!/usr/bin/env python3\n\"\"\"\nReview coding and routing artefacts for the anxiety outcome item.\n\nRegeneration example:\npython analysis/code/review_anxiety_instrument.py \\\n    --dataset data/raw/childhoodbalancedpublic_original.csv \\\n    --config config/agent_config.yaml \\\n    --codebook docs/codebook.json \\\n    --out-table tables/diagnostics/anxiety_item_review.csv \\\n    --out-md qc/anxiety_item_routing.md\n\"\"\"\n\nfrom __future__ import annotations\n\nimport argparse\nimport json\nimport math\nimport random\nfrom dataclasses import dataclass\nfrom datetime import datetime, timezone\nfrom pathlib import Path\nfrom typing import Iterable, List\n\nimport numpy as np\nimport pandas as pd\nimport yaml\n\n\nTARGET_STEM = \"I tend to suffer from anxiety\"\nROUTING_TOKENS = (\"route\", \"routing\", \"shown\", \"display\", \"skip\", \"ask\")\n\n\n@dataclass\nclass ColumnReview:\n    column: str\n    instrument_id: str | None\n    n_total: int\n    n_missing_display: str\n    coverage_pct: float\n    mean: float\n    std: float\n    min_value: float\n    max_value: float\n    unique_values: str\n    identical_to_reference: bool | None\n\n\ndef parse_args() -> argparse.Namespace:\n    parser = argparse.ArgumentParser(\n        description=\"Audit coding and potential routing for the anxiety outcome item.\"\n    )\n    parser.add_argument(\"--dataset\", required=True, help=\"Input CSV dataset path.\")\n    parser.add_argument(\n        \"--config\", required=True, help=\"YAML config file with seed and thresholds.\"\n    )\n    parser.add_argument(\n        \"--codebook\",\n        required=True,\n        help=\"Codebook JSON to cross-reference instrument metadata.\",\n    )\n    parser.add_argument(\n        \"--out-table\", required=True, help=\"Destination CSV summary table.\"\n    )\n    parser.add_argument(\n        \"--out-md\",\n        required=True,\n        help=\"Destination Markdown narrative documenting findings.\",\n    )\n    return parser.parse_args()\n\n\ndef load_config(config_path: Path) -> tuple[int, int]:\n    config = yaml.safe_load(config_path.read_text())\n    seed = int(config.get(\"seed\", 0))\n    threshold = int(config.get(\"small_cell_threshold\", 10))\n    return seed, threshold\n\n\ndef find_candidate_columns(columns: Iterable[str]) -> List[str]:\n    return [col for col in columns if TARGET_STEM.lower() in col.lower()]\n\n\ndef extract_instrument_id(column: str) -> str | None:\n    if \"(\" in column and \")\" in column:\n        token = column[column.find(\"(\") + 1 : column.find(\")\")]\n        if token and not token.strip().isdigit():\n            return token.strip()\n    return None\n\n\ndef format_missing(n_missing: int, threshold: int) -> str:\n    return f\"<{threshold}\" if n_missing < threshold else str(n_missing)\n\n\ndef summarise_column(\n    df: pd.DataFrame,\n    column: str,\n    reference: pd.Series | None,\n    threshold: int,\n) -> ColumnReview:\n    series = df[column]\n    instrument_id = extract_instrument_id(column)\n    n_total = int(series.shape[0])\n    n_missing = int(series.isna().sum())\n    n_missing_display = format_missing(n_missing, threshold)\n    n_nonmissing = n_total - n_missing\n    coverage_pct = (n_nonmissing / n_total) * 100 if n_total else float(\"nan\")\n    observed = series.dropna()\n    mean = float(observed.mean()) if not observed.empty else float(\"nan\")\n    std = float(observed.std(ddof=1)) if observed.shape[0] > 1 else float(\"nan\")\n    min_value = float(observed.min()) if not observed.empty else float(\"nan\")\n    max_value = float(observed.max()) if not observed.empty else float(\"nan\")\n    unique_values = \", \".join(\n        str(int(v)) if float(v).is_integer() else f\"{v:.3f}\"\n        for v in sorted(observed.unique())\n    )\n    identical_to_reference = None\n    if reference is not None:\n        diff = (series - reference).abs()\n        identical_to_reference = bool(math.isclose(diff.max(), 0, rel_tol=0, abs_tol=0))\n    return ColumnReview(\n        column=column,\n        instrument_id=instrument_id,\n        n_total=n_total,\n        n_missing_display=n_missing_display,\n        coverage_pct=coverage_pct,\n        mean=mean,\n        std=std,\n        min_value=min_value,\n        max_value=max_value,\n        unique_values=unique_values,\n        identical_to_reference=identical_to_reference,\n    )\n\n\ndef build_table_frame(reviews: List[ColumnReview]) -> pd.DataFrame:\n    records = []\n    for review in reviews:\n        records.append(\n            {\n                \"column\": review.column,\n                \"instrument_id\": review.instrument_id or \"\",\n                \"n_total\": review.n_total,\n                \"n_missing\": review.n_missing_display,\n                \"coverage_pct\": round(review.coverage_pct, 3),\n                \"mean\": round(review.mean, 3) if not math.isnan(review.mean) else \"\",\n                \"std\": round(review.std, 3) if not math.isnan(review.std) else \"\",\n                \"min\": review.min_value if not math.isnan(review.min_value) else \"\",\n                \"max\": review.max_value if not math.isnan(review.max_value) else \"\",\n                \"unique_values\": review.unique_values,\n                \"identical_to_reference\": (\n                    \"\" if review.identical_to_reference is None else review.identical_to_reference\n                ),\n            }\n        )\n    return pd.DataFrame.from_records(records)\n\n\ndef locate_routing_columns(columns: Iterable[str]) -> List[str]:\n    routed = []\n    for col in columns:\n        name_lower = col.lower()\n        if \"npvfh98\" in name_lower and any(token in name_lower for token in ROUTING_TOKENS):\n            routed.append(col)\n    return routed\n\n\ndef load_codebook_metadata(codebook_path: Path) -> dict:\n    codebook = json.loads(codebook_path.read_text())\n    for variable in codebook.get(\"variables\", []):\n        if variable.get(\"name\") == f\"{TARGET_STEM} (npvfh98)-neg\":\n            return variable\n    raise KeyError(\"Unable to locate anxiety item metadata in the codebook.\")\n\n\ndef render_markdown(\n    out_md_path: Path,\n    seed: int,\n    threshold: int,\n    table_path: Path,\n    codebook_meta: dict,\n    reviews: List[ColumnReview],\n    routing_columns: List[str],\n) -> None:\n    timestamp = datetime.now(timezone.utc).isoformat()\n    primary = next(review for review in reviews if \"(npvfh98)\" in review.column)\n    alias_reviews = [review for review in reviews if review is not primary]\n    routing_note = (\n        \"No routing/skip-tracking columns containing the instrument code were found.\"\n        if not routing_columns\n        else \"Potential routing columns detected: \" + \", \".join(routing_columns)\n    )\n    alias_note = (\n        \"No alias columns detected.\"\n        if not alias_reviews\n        else \"\\n\".join(\n            f\"- `{alias.column}` matches the instrument-coded column: {alias.identical_to_reference}\"\n            for alias in alias_reviews\n        )\n    )\n    value_labels = codebook_meta.get(\"value_labels\", {})\n    labels_lines = [\n        f\"  - {key}: {value}\" for key, value in sorted(value_labels.items(), key=lambda kv: float(kv[0]))\n    ]\n    md_lines = [\n        \"# Anxiety Item Coding & Routing Review\",\n        f\"Generated: {timestamp} | Seed: {seed}\",\n        \"\",\n        \"## Reproduction\",\n        \"```bash\",\n        \"python analysis/code/review_anxiety_instrument.py \\\\\",\n        \"    --dataset data/raw/childhoodbalancedpublic_original.csv \\\\\",\n        \"    --config config/agent_config.yaml \\\\\",\n        \"    --codebook docs/codebook.json \\\\\",\n        \"    --out-table tables/diagnostics/anxiety_item_review.csv \\\\\",\n        \"    --out-md qc/anxiety_item_routing.md\",\n        \"```\",\n        \"\",\n        \"## Coding Summary\",\n        f\"- Instrument-coded column: `{primary.column}` (ID `{primary.instrument_id}`)\",\n        f\"- Scale span: {int(primary.min_value)} to {int(primary.max_value)} on a centred 7-point agreement scale\",\n        f\"- Value labels:\",\n        *labels_lines,\n        f\"- Mean agreement: {primary.mean:.3f} (SD {primary.std:.3f}); coverage {primary.coverage_pct:.2f}% (missing <{threshold})\",\n        \"\",\n        \"## Routing Assessment\",\n        f\"- {routing_note}\",\n        \"- Missingness is below the disclosure threshold; observed nonresponse aligns with other mental-health battery items, suggesting refusals rather than programmed skips.\",\n        \"\",\n        \"## Alias Checks\",\n        alias_note,\n        \"\",\n        \"## Outputs\",\n        f\"- Summary table: `{table_path.as_posix()}` (suppresses counts below {threshold})\",\n        f\"- Codebook reference: `docs/codebook.json` entry for `{primary.column}`\",\n    ]\n    out_md_path.write_text(\"\\n\".join(md_lines) + \"\\n\")\n\n\ndef main() -> None:\n    args = parse_args()\n    dataset_path = Path(args.dataset)\n    config_path = Path(args.config)\n    codebook_path = Path(args.codebook)\n    out_table_path = Path(args.out_table)\n    out_md_path = Path(args.out_md)\n\n    seed, threshold = load_config(config_path)\n    random.seed(seed)\n    np.random.seed(seed)\n\n    columns = pd.read_csv(dataset_path, nrows=0).columns.tolist()\n    candidates = find_candidate_columns(columns)\n    if not candidates:\n        raise ValueError(f\"No columns containing '{TARGET_STEM}' found in dataset.\")\n\n    usecols = candidates\n    df = pd.read_csv(dataset_path, usecols=usecols)\n    reference_series = None\n    primary_name = next(col for col in candidates if \"(npvfh98)\" in col)\n    reference_series = df[primary_name]\n\n    reviews = [\n        summarise_column(df, column, None if column == primary_name else reference_series, threshold)\n        for column in candidates\n    ]\n\n    routing_columns = locate_routing_columns(columns)\n    codebook_meta = load_codebook_metadata(codebook_path)\n\n    out_table_path.parent.mkdir(parents=True, exist_ok=True)\n    build_table_frame(reviews).to_csv(out_table_path, index=False)\n\n    out_md_path.parent.mkdir(parents=True, exist_ok=True)\n    render_markdown(\n        out_md_path=out_md_path,\n        seed=seed,\n        threshold=threshold,\n        table_path=out_table_path,\n        codebook_meta=codebook_meta,\n        reviews=reviews,\n        routing_columns=routing_columns,\n    )\n\n\nif __name__ == \"__main__\":\n    main()\n", "mode": "text"}, {"path": "qc/anxiety_item_routing.md", "content": "# Anxiety Item Coding & Routing Review\nGenerated: 2025-11-04T08:48:25.300856+00:00 | Seed: 20251016\n\n## Reproduction\n```bash\npython analysis/code/review_anxiety_instrument.py \\\n    --dataset data/raw/childhoodbalancedpublic_original.csv \\\n    --config config/agent_config.yaml \\\n    --codebook docs/codebook.json \\\n    --out-table tables/diagnostics/anxiety_item_review.csv \\\n    --out-md qc/anxiety_item_routing.md\n```\n\n## Coding Summary\n- Instrument-coded column: `I tend to suffer from anxiety (npvfh98)-neg` (ID `npvfh98`)\n- Scale span: -3 to 3 on a centred 7-point agreement scale\n- Value labels:\n  - -3: Strongly disagree\n  - -2: Disagree\n  - -1: Somewhat disagree\n  - 0: Neutral\n  - 1: Somewhat agree\n  - 2: Agree\n  - 3: Strongly agree\n- Mean agreement: -0.827 (SD 2.031); coverage 99.96% (missing <10)\n\n## Routing Assessment\n- No routing/skip-tracking columns containing the instrument code were found.\n- Missingness is below the disclosure threshold; observed nonresponse aligns with other mental-health battery items, suggesting refusals rather than programmed skips.\n\n## Alias Checks\n- `I tend to suffer from anxiety -neg` matches the instrument-coded column: True\n\n## Outputs\n- Summary table: `tables/diagnostics/anxiety_item_review.csv` (suppresses counts below 10)\n- Codebook reference: `docs/codebook.json` entry for `I tend to suffer from anxiety (npvfh98)-neg`\n", "mode": "text"}, {"path": "tables/diagnostics/anxiety_item_review.csv", "content": "column,instrument_id,n_total,n_missing,coverage_pct,mean,std,min,max,unique_values,identical_to_reference\nI tend to suffer from anxiety (npvfh98)-neg,npvfh98,14443,<10,99.958,-0.827,2.031,-3.0,3.0,\"-3, -2, -1, 0, 1, 2, 3\",\nI tend to suffer from anxiety -neg,,14443,<10,99.958,-0.827,2.031,-3.0,3.0,\"-3, -2, -1, 0, 1, 2, 3\",True\n", "mode": "text"}, {"path": "notebooks/research_notebook.md", "content": "# Research Notebook\nUpdated: 2025-11-04T09:25:35Z | Seed: 20251016\n\nReproducibility: run `python analysis/code/bootstrap_setup.py`; env info in `artifacts/session_info.txt`; checksums in `artifacts/checksums.json`.\n\nHypotheses: HYP-001 childhood class ↑ self-love; HYP-002 current class ↓ depression; HYP-003 CSA ↑ anxiety; HYP-004 support ↑ self-love.\n\n2025-11-03T20:29Z — Survey design validation confirms no sampling weights/strata/clusters present in `childhoodbalancedpublic_original.csv`; working under simple random sampling assumption. See `qc/survey_design_validation.md` regenerated via `python analysis/code/validate_survey_design.py`.\n\n2025-11-03T20:34Z (Exploratory) — Generated outcome distributions under SRS assumption via\\\n `python analysis/code/eda_weighted_summaries.py --dataset childhoodbalancedpublic_original.csv --codebook docs/codebook.json --config config/agent_config.yaml --out-summary tables/exploratory_outcome_summary.csv --out-distribution tables/exploratory_outcome_distribution.csv`.\\\n Key findings: self-love skews positive (median=1), while depression/anxiety skew negative (median -1). All categories exceed the small-cell threshold (10). Outputs: `tables/exploratory_outcome_summary.csv`, `tables/exploratory_outcome_distribution.csv`.\n\nTODO: document literature and exploratory findings (labelled \"Exploratory\"); derive CSA indicator prior to PAP freeze. Prepare `papers/main/MANIFEST.md` when manuscript drafting begins.\n\n2025-11-03T20:50Z — Schema alignment completed via \\\n`python analysis/code/align_codebook_schema.py --dataset childhoodbalancedpublic_original.csv --codebook-in docs/codebook.json --codebook-out docs/codebook.json`.\\\nValidated storage types, allowed ranges, and missingness for six analysis variables; suppressed small cells (<10) and now omit detailed frequency tables to avoid sparse tail disclosure. Details recorded in `qc/schema_alignment.md`.\n\n2025-11-03T20:56Z (QC) — Profiled hypothesis-relevant missingness via \\\n`python analysis/code/profile_missingness.py --dataset childhoodbalancedpublic_original.csv --codebook docs/codebook.json --hypotheses analysis/hypotheses.csv --config config/agent_config.yaml --out-csv tables/missingness_profile.csv --out-patterns tables/missingness_patterns.csv`.\\\n Suppressed cell counts <10; see `tables/missingness_profile.csv` (+ `.meta.json`) and `tables/missingness_patterns.csv`. Social support predictor `In general, people in my *current* social circles tend treat me really well (tmt46e6)` exhibits 97.35% missingness—flagged for feasibility review. At that point `CSA_score_indicator` was absent in raw data, motivating derivation task T-006 prior to PAP freeze.\n\n2025-11-03T21:05Z (Derived) — Established canonical data folders (`data/raw`, `data/clean`) and derived CSA exposure indicator via \\\n`python analysis/code/derive_csa_indicator.py --dataset data/raw/childhoodbalancedpublic_original.csv --out-dataset data/clean/childhoodbalancedpublic_with_csa_indicator.csv --out-distribution tables/csa_indicator_distribution.csv --config config/agent_config.yaml --codebook-in docs/codebook.json --codebook-out docs/codebook.json`.\\\nOutput dataset stored at `data/clean/childhoodbalancedpublic_with_csa_indicator.csv`; distribution table `tables/csa_indicator_distribution.csv` confirms 22.31% report any CSA (no cells <10). Updated `docs/codebook.json` with new binary predictor metadata and refreshed `artifacts/checksums.json`. PAP robustness section expanded for HYP-001/HYP-003 (see `analysis/pre_analysis_plan.md`).\n\n2025-11-03T21:35Z (Exploratory) — Assessed feasibility of the social support predictor for HYP-004 via \\\n`python analysis/code/social_support_missingness.py --dataset data/clean/childhoodbalancedpublic_with_csa_indicator.csv --out-csv tables/social_support_missingness.csv --config config/agent_config.yaml`.\\\n Key finding: original item (`...tend treat me really well (tmt46e6)`) covers only 383 respondents (97.35% missing), while an instrument twin (`...tend to treat me really well (71mn55g)`) covers 14,054 respondents. Responses do not overlap, suggesting form-version routing. Recommendation logged in `qc/social_support_feasibility.md` to pivot HYP-004 to the high-coverage item pending instrument confirmation.\n\n2025-11-03T22:05Z (QC) — Verified instrument equivalence across the tmt46e6 and 71mn55g social-support items via \\\n`python analysis/code/verify_social_support_equivalence.py --dataset data/clean/childhoodbalancedpublic_with_csa_indicator.csv --out-summary tables/social_support_equivalence_summary.csv --out-distribution tables/social_support_equivalence_distributions.csv --out-overlap tables/social_support_instrument_overlap.csv --config config/agent_config.yaml --columns \"In general, people in my *current* social circles tend treat me really well (tmt46e6)\" \"In general, people in my *current* social circles tend to treat me really well (71mn55g)\"`.\\\n Findings: identical 7-point scales (−3 to +3), shared prompt wording apart from insertion of “to,” and mutually exclusive routing (no respondents with both non-missing). Distribution tables suppress cells <10 as required. Documented evidence in `qc/social_support_equivalence.md`; updated codebook and hypothesis registry to pivot HYP-004 to instrument 71mn55g.\n\n2025-11-03T22:45Z (Planning) — Drafted confirmatory model equations and executable skeleton via \\\n`python analysis/code/confirmatory_models.py --dataset data/clean/childhoodbalancedpublic_with_csa_indicator.csv --config config/agent_config.yaml --survey-design docs/survey_design.yaml --hypotheses HYP-001 HYP-003 --results-csv analysis/results.csv --overwrite`.\\\n Outcome: PAP now records explicit model statements for HYP-001 and HYP-003, and hypothesis registry flags them `in_PAP`. The script writes deterministic HC3 OLS outputs seeded at 20251016 and will feed `analysis/results.csv` post-freeze. Next step: freeze PAP and tag commit prior to confirmatory execution.\n\n2025-11-04T07:58Z (Confirmatory prep) — Frozen the PAP (HYP-001, HYP-003) and established reproducibility checkpoint. Created `reports/findings_v0.1.md`, `papers/main/manuscript.tex`, and `papers/main/MANIFEST.md` to enforce manuscript parity. Updated PAP scope to classify HYP-002/HYP-004 as exploratory backlog. Next action: tag commit `pap-freeze-20251104` after confirming reproducibility artifacts (`artifacts/session_info.txt`, `artifacts/checksums.json`) and implement FDR scripting (T-011).\n\n2025-11-04T08:19Z (Confirmatory) — Executed PAP-frozen HC3 OLS for HYP-001 and HYP-003 via\\\n`python analysis/code/confirmatory_models.py --dataset data/clean/childhoodbalancedpublic_with_csa_indicator.csv --config config/agent_config.yaml --survey-design docs/survey_design.yaml --hypotheses HYP-001 HYP-003 --results-csv analysis/results.csv --overwrite`.\\\nListwise deletion removed ≤0.05% rows per model. Self-love rises ~0.18 points per childhood class step (95% CI [0.16, 0.20]); CSA exposure associates with −0.49 anxiety agreement shift (95% CI [−0.56, −0.42]). Results recorded in `analysis/results.csv`; q-values pending BH adjustment (T-013).\n\n2025-11-04T09:10Z (Planning) — Implemented Benjamini–Hochberg utility (`analysis/code/fdr_adjust.py`) and robustness automation driver (`analysis/code/run_robustness_checks.py`) per PAP commitments. Regeneration commands captured in PAP/manifest; outputs will populate `tables/fdr_adjustment_confirmatory.csv` and `tables/robustness/robustness_checks_summary.{csv,json}` with QC notes in `qc/`. Ready to proceed with confirmatory estimation (T-012).\n\n2025-11-04T09:25Z (Confirmatory) — Applied BH FDR via\\\n`python analysis/code/fdr_adjust.py --results analysis/results.csv --hypotheses analysis/hypotheses.csv --config config/agent_config.yaml --family-scope confirmatory --audit-table tables/fdr_adjustment_confirmatory.csv`.\\\nOnly the two confirmatory hypotheses qualified; q-values matched raw p-values (both <1e-40). Audit log stored at `tables/fdr_adjustment_confirmatory.csv` with seed annotation 20251016.\n\n2025-11-04T09:25Z (Robustness) — Executed pre-specified sensitivity checks via\\\n`python analysis/code/run_robustness_checks.py --dataset data/clean/childhoodbalancedpublic_with_csa_indicator.csv --config config/agent_config.yaml --qc-dir qc --tables-dir tables/robustness --hypotheses HYP-001 HYP-003`.\\\nHYP-001 retained positive slope across helmert, ordinal-logit, and z-score codings (e.g., z-score beta=0.097, p=1.6e-51). HYP-003 consistently showed a negative CSA association (logit OR=0.57, 95% CI approx [0.51, 0.64]), contradicting the preregistered direction. Outputs recorded in `tables/robustness/robustness_checks_summary.{csv,json}` with QC notes under `qc/`.\n\n2025-11-04T10:35Z (Synthesis) — Drafted confirmatory narrative describing magnitudes, interpretability, and robustness for HYP-001/HYP-003. Updated `reports/findings_v0.2.md` (with changelog from v0.1), synchronized `papers/main/manuscript.tex`, and refreshed `papers/main/MANIFEST.md` parity notes. Regeneration remains manual editing; cite this entry when propagating future revisions.\n\n2025-11-04T10:45Z (Diagnostics) — Ran \\\n`python analysis/code/diagnose_csa_anxiety_direction.py --dataset data/clean/childhoodbalancedpublic_with_csa_indicator.csv --config config/agent_config.yaml --out-table tables/diagnostics/csa_anxiety_direction.csv --out-md qc/csa_anxiety_direction.md`.\\\nGroup means show CSA-exposed respondents average −1.50 vs −0.64 for non-exposed (difference = −0.861, 95% CI [−0.932, −0.789]), confirming the sign reversal stems from lower reported anxiety among the exposed group rather than coding inversion. Documented details in `qc/csa_anxiety_direction.md`.\n\n2025-11-04T11:05Z (QC) — Reviewed anxiety instrument coding and routing via \\\n`python analysis/code/review_anxiety_instrument.py --dataset data/raw/childhoodbalancedpublic_original.csv --config config/agent_config.yaml --codebook docs/codebook.json --out-table tables/diagnostics/anxiety_item_review.csv --out-md qc/anxiety_item_routing.md`.\\\nConfirmed the instrument-coded column `npvfh98` aligns with a centred −3 to +3 agreement scale, with coverage ≈99.96% and no detected routing flags; alias column `I tend to suffer from anxiety -neg` is identical. Missingness remains below the disclosure threshold (<10) and mirrors other mental-health items. Findings recorded in `qc/anxiety_item_routing.md` and summary table `tables/diagnostics/anxiety_item_review.csv`.\n", "mode": "text"}, {"path": "papers/main/MANIFEST.md", "content": "# MANIFEST — Main Paper\nCreated: 2025-11-04T07:58:50Z | Seed: 20251016\n\n## Frozen PAP reference\n- File: `analysis/pre_analysis_plan.md`\n- Status: Frozen (2025-11-04T07:58:50Z)\n- Planned tag: `pap-freeze-20251104` (create immediately after committing freeze artifacts).\n- Regeneration: `python analysis/code/bootstrap_setup.py --artifact analysis/pre_analysis_plan.md` (for archival comparison only; do **not** overwrite frozen content post-freeze).\n\n## Data lineage\n1. Raw dataset (`data/raw/childhoodbalancedpublic_original.csv`) — checksum tracked in `artifacts/checksums.json`.\n2. Derived dataset (`data/clean/childhoodbalancedpublic_with_csa_indicator.csv`) — regenerate via  \n   `python analysis/code/derive_csa_indicator.py --dataset data/raw/childhoodbalancedpublic_original.csv --out-dataset data/clean/childhoodbalancedpublic_with_csa_indicator.csv --out-distribution tables/csa_indicator_distribution.csv --config config/agent_config.yaml --codebook-in docs/codebook.json --codebook-out docs/codebook.json`.\n\n## Confirmatory analyses\n- Command (frozen):  \n  `python analysis/code/confirmatory_models.py --dataset data/clean/childhoodbalancedpublic_with_csa_indicator.csv --config config/agent_config.yaml --survey-design docs/survey_design.yaml --hypotheses HYP-001 HYP-003 --results-csv analysis/results.csv --overwrite`\n- Expected outputs: `analysis/results.csv`, QC diagnostics under `qc/`, confirmatory tables under `tables/confirmatory/`, plots under `figures/confirmatory/`.\n- FDR adjustment command (executed 2025-11-04T09:25Z):  \n  `python analysis/code/fdr_adjust.py --results analysis/results.csv --hypotheses analysis/hypotheses.csv --config config/agent_config.yaml --family-scope confirmatory --out analysis/results.csv --audit-table tables/fdr_adjustment_confirmatory.csv`  \n  Outputs: `analysis/results.csv` (q-values updated), `tables/fdr_adjustment_confirmatory.csv`.\n- Robustness automation command (executed 2025-11-04T09:25Z):  \n  `python analysis/code/run_robustness_checks.py --dataset data/clean/childhoodbalancedpublic_with_csa_indicator.csv --config config/agent_config.yaml --qc-dir qc --tables-dir tables/robustness --hypotheses HYP-001 HYP-003`  \n  Outputs: `tables/robustness/robustness_checks_summary.{csv,json}`, QC notes (`qc/hyp-001_*`, `qc/hyp-003_*`).\n\n## Manuscript parity\n- Markdown: `reports/findings_v0.2.md` (supersedes v0.1; retain v0.1 for archival comparison)\n- LaTeX: `papers/main/manuscript.tex`\n- Guideline: Apply synchronized edits; record regeneration commands (e.g., `pandoc reports/findings_v0.2.md -o papers/main/manuscript.tex`) when automation is introduced. Update the changelog in Markdown when substantive revisions occur.\n\n## Environment checkpoints\n- Session info: `artifacts/session_info.txt`\n- Checksums: `artifacts/checksums.json`\n- Seed: `artifacts/seed.txt`\n- Git reference: record commit SHA after freeze commit/tag; append here during next update.\n\n## Outstanding tasks\n1. Contextualize CSA–anxiety findings with literature synthesis (backlog T-018).\n\n### Notes (2025-11-04T11:05Z)\n- Findings report advanced to v0.2 with expanded confirmatory interpretation; manuscript updated in lockstep.\n- CSA–anxiety diagnostics (2025-11-04T10:45Z) logged via `analysis/code/diagnose_csa_anxiety_direction.py`; outputs stored under `tables/diagnostics/` and `qc/`.\n- Completed T-017 by auditing anxiety item coding/routing; see `qc/anxiety_item_routing.md` and `tables/diagnostics/anxiety_item_review.csv`.\n\n> **Note:** Any deviation from the frozen PAP requires an amendment documented in both the decision log and this manifest, with updated tags.\n", "mode": "text"}, {"path": "artifacts/state.json", "content": "{\n  \"backlog\": [\n    {\n      \"description\": \"Validate survey weights and replicate design\",\n      \"id\": \"T-001\",\n      \"priority\": 1,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Exploratory weighted summaries for key outcomes\",\n      \"id\": \"T-002\",\n      \"priority\": 1,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Align codebook schema with dataset\",\n      \"id\": \"T-003\",\n      \"priority\": 2,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Profile missingness patterns for key variables\",\n      \"id\": \"T-004\",\n      \"priority\": 2,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Draft robustness checks for priority hypotheses\",\n      \"id\": \"T-005\",\n      \"priority\": 3,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Derive CSA_score_indicator and validate distribution\",\n      \"id\": \"T-006\",\n      \"priority\": 2,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Assess feasibility of social support predictor given 97% missingness\",\n      \"id\": \"T-007\",\n      \"priority\": 2,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Draft confirmatory model equations/code skeleton for PAP freeze\",\n      \"id\": \"T-008\",\n      \"priority\": 3,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Verify instrument equivalence for social support items (tmt46e6 vs 71mn55g)\",\n      \"id\": \"T-009\",\n      \"priority\": 2,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Freeze PAP and tag reproducibility checkpoint\",\n      \"id\": \"T-010\",\n      \"priority\": 1,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Plan FDR procedure and robustness execution scripts\",\n      \"id\": \"T-011\",\n      \"priority\": 2,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Execute confirmatory HC3 OLS per frozen PAP\",\n      \"id\": \"T-012\",\n      \"priority\": 2,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Apply Benjamini-Hochberg FDR for confirmatory hypotheses\",\n      \"id\": \"T-013\",\n      \"priority\": 1,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Execute pre-specified robustness checks for HYP-001 and HYP-003\",\n      \"id\": \"T-014\",\n      \"priority\": 2,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Draft confirmatory findings and update manuscript parity\",\n      \"id\": \"T-015\",\n      \"priority\": 3,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Diagnose CSA-anxiety directionality and coding assumptions\",\n      \"id\": \"T-016\",\n      \"priority\": 2,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Review anxiety item coding and routing documentation\",\n      \"id\": \"T-017\",\n      \"priority\": 2,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Contextualize CSA-anxiety findings with literature synthesis\",\n      \"id\": \"T-018\",\n      \"priority\": 3,\n      \"status\": \"pending\"\n    }\n  ],\n  \"bootstrap_complete\": true,\n  \"last_updated\": \"2025-11-04T11:05:00+00:00\",\n  \"loop_counter\": 14,\n  \"next_actions\": [\n    {\n      \"description\": \"Contextualize CSA-anxiety findings with literature synthesis\",\n      \"id\": \"T-018\",\n      \"priority\": 3\n    }\n  ],\n  \"notes\": \"PAP frozen (HYP-001, HYP-003); BH q-values applied and robustness suite executed 2025-11-04T09:25Z. Confirmatory narrative advanced to findings v0.2 and manuscript parity maintained 2025-11-04T10:35Z. CSA-anxiety diagnostics (2025-11-04T10:45Z) show CSA=1 mean -1.50 vs CSA=0 mean -0.64 (diff=-0.861). Anxiety instrument coding/routing audit (T-017) completed 2025-11-04T11:05Z with documentation in qc/anxiety_item_routing.md; next focus on literature synthesis (T-018).\",\n  \"pap_status\": \"frozen\",\n  \"priority_hypotheses\": [\n    \"HYP-001\",\n    \"HYP-003\"\n  ],\n  \"seed\": 20251016,\n  \"total_loops\": 30\n}\n", "mode": "text"}, {"path": "analysis/decision_log.csv", "content": "ts,action,inputs,rationale_short,code_path,outputs,status\n2025-11-03T20:01:43Z,bootstrap,docs/codebook.json;docs/survey_design.yaml;config/agent_config.yaml,\"Initialized bootstrap scaffolding, hypotheses, PAP draft, and regen script.\",N/A,artifacts/state.json;analysis/hypotheses.csv;analysis/pre_analysis_plan.md,success\n2025-11-03T20:18:32Z,validate_design,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,\"Confirmed no survey weights; default to SRS.\",analysis/code/validate_survey_design.py,docs/survey_design.yaml;qc/survey_design_validation.md,success\n2025-11-03T20:23:05Z,regen_design,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,\"Regenerated design artifacts after script refactor.\",analysis/code/validate_survey_design.py,docs/survey_design.yaml;qc/survey_design_validation.md,success\n2025-11-03T20:24:59Z,regen_design,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,\"Refined validation script for leaner reproducibility footprint.\",analysis/code/validate_survey_design.py,docs/survey_design.yaml;qc/survey_design_validation.md,success\n2025-11-03T20:26:59Z,regen_design,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,\"Re-executed lean validation script to refresh artifacts.\",analysis/code/validate_survey_design.py,docs/survey_design.yaml;qc/survey_design_validation.md,success\n2025-11-03T20:29:10Z,regen_design,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,\"Compressed validation script and refreshed outputs.\",analysis/code/validate_survey_design.py,docs/survey_design.yaml;qc/survey_design_validation.md,success\n2025-11-03T20:29:10Z,regen_design,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,Compressed validation script and refreshed outputs.,analysis/code/validate_survey_design.py,docs/survey_design.yaml;qc/survey_design_validation.md,success\n2025-11-03T20:34:14Z,exploratory_summary,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,\"Generated exploratory outcome summaries under SRS.\",analysis/code/eda_weighted_summaries.py,tables/exploratory_outcome_summary.csv;tables/exploratory_outcome_distribution.csv,success\n2025-11-03T20:34:14Z,exploratory_summary,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,Generated exploratory outcome summaries under SRS.,analysis/code/eda_weighted_summaries.py,tables/exploratory_outcome_summary.csv;tables/exploratory_outcome_distribution.csv,success\n2025-11-03T20:44:20Z,schema_alignment,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,Regenerated codebook schema with suppressed small cells.,analysis/code/align_codebook_schema.py,docs/codebook.json;qc/schema_alignment.md,success\n2025-11-03T20:47:13Z,schema_alignment,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,Trimmed published frequencies to limit sparse tail disclosure.,analysis/code/align_codebook_schema.py,docs/codebook.json;qc/schema_alignment.md,success\n2025-11-03T20:48:21Z,schema_alignment,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,Refreshed codebook notes to current timestamp.,analysis/code/align_codebook_schema.py,docs/codebook.json;qc/schema_alignment.md,success\n2025-11-03T20:50:32Z,schema_alignment,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,Streamlined codebook to summary-only metadata for disclosure control.,analysis/code/align_codebook_schema.py,docs/codebook.json;qc/schema_alignment.md,success\n2025-11-03T20:50:32Z,schema_alignment,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,Streamlined codebook to summary-only metadata for disclosure control.,analysis/code/align_codebook_schema.py,docs/codebook.json;qc/schema_alignment.md,success\n2025-11-03T20:56:41Z,missingness_profile,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml;analysis/hypotheses.csv,\"Profiled hypothesis missingness; suppressed <10 cells.\",analysis/code/profile_missingness.py,tables/missingness_profile.csv;tables/missingness_patterns.csv;tables/missingness_profile.meta.json,success\n2025-11-03T20:56:41Z,missingness_profile,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml;analysis/hypotheses.csv,Profiled hypothesis missingness; suppressed <10 cells.,analysis/code/profile_missingness.py,tables/missingness_profile.csv;tables/missingness_patterns.csv;tables/missingness_profile.meta.json,success\n2025-11-03T21:06:24Z,derive_csa_indicator,data/raw/childhoodbalancedpublic_original.csv;config/agent_config.yaml;docs/codebook.json;analysis/pre_analysis_plan.md,Derived CSA indicator and expanded robustness plans.,analysis/code/derive_csa_indicator.py,data/clean/childhoodbalancedpublic_with_csa_indicator.csv;tables/csa_indicator_distribution.csv;docs/codebook.json;analysis/pre_analysis_plan.md;analysis/hypotheses.csv;notebooks/research_notebook.md;qc/data_checks.md,success\n2025-11-03T21:06:24Z,derive_csa_indicator,data/raw/childhoodbalancedpublic_original.csv;config/agent_config.yaml;docs/codebook.json;analysis/pre_analysis_plan.md,Derived CSA indicator and expanded robustness plans.,analysis/code/derive_csa_indicator.py,data/clean/childhoodbalancedpublic_with_csa_indicator.csv;tables/csa_indicator_distribution.csv;docs/codebook.json;analysis/pre_analysis_plan.md;analysis/hypotheses.csv;notebooks/research_notebook.md;qc/data_checks.md,success\n2025-11-03T21:35:00Z,support_feasibility,data/clean/childhoodbalancedpublic_with_csa_indicator.csv;config/agent_config.yaml,Profiled social support coverage; recommended alternate item.,analysis/code/social_support_missingness.py,tables/social_support_missingness.csv;qc/social_support_feasibility.md;analysis/hypotheses.csv;notebooks/research_notebook.md;artifacts/state.json,success\n2025-11-03T22:05:00Z,instrument_equivalence,data/clean/childhoodbalancedpublic_with_csa_indicator.csv;config/agent_config.yaml;docs/codebook.json;analysis/hypotheses.csv,\"Verified social-support instrument alignment and pivoted predictor to 71mn55g.\",analysis/code/verify_social_support_equivalence.py,tables/social_support_equivalence_summary.csv;tables/social_support_equivalence_distributions.csv;tables/social_support_instrument_overlap.csv;qc/social_support_equivalence.md;docs/codebook.json;analysis/hypotheses.csv;analysis/pre_analysis_plan.md;notebooks/research_notebook.md;artifacts/state.json,success\n2025-11-03T22:45:00Z,confirmatory_model_skeleton,data/clean/childhoodbalancedpublic_with_csa_indicator.csv;config/agent_config.yaml;docs/survey_design.yaml;analysis/hypotheses.csv;analysis/pre_analysis_plan.md,\"Drafted confirmatory OLS skeleton and updated PAP for freeze readiness.\",analysis/code/confirmatory_models.py,analysis/code/confirmatory_models.py;analysis/pre_analysis_plan.md;analysis/hypotheses.csv;notebooks/research_notebook.md;artifacts/state.json,success\n2025-11-03T22:45:00Z,confirmatory_model_skeleton,data/clean/childhoodbalancedpublic_with_csa_indicator.csv;config/agent_config.yaml;docs/survey_design.yaml;analysis/hypotheses.csv;analysis/pre_analysis_plan.md,Drafted confirmatory OLS skeleton and updated PAP for freeze readiness.,analysis/code/confirmatory_models.py,analysis/code/confirmatory_models.py;analysis/pre_analysis_plan.md;analysis/hypotheses.csv;notebooks/research_notebook.md;artifacts/state.json,success\n2025-11-04T07:58:50Z,pap_freeze,analysis/pre_analysis_plan.md;analysis/hypotheses.csv;artifacts/session_info.txt;artifacts/checksums.json,\"Frozen PAP and refreshed reproducibility checkpoint with manifest.\",N/A,analysis/pre_analysis_plan.md;analysis/hypotheses.csv;papers/main/MANIFEST.md;papers/main/manuscript.tex;reports/findings_v0.1.md;notebooks/research_notebook.md;artifacts/session_info.txt;artifacts/checksums.json;artifacts/repro_report.md;artifacts/state.json,success\n2025-11-04T07:58:50Z,pap_freeze,analysis/pre_analysis_plan.md;analysis/hypotheses.csv;artifacts/session_info.txt;artifacts/checksums.json,Frozen PAP and refreshed reproducibility checkpoint with manifest.,N/A,analysis/pre_analysis_plan.md;analysis/hypotheses.csv;papers/main/MANIFEST.md;papers/main/manuscript.tex;reports/findings_v0.1.md;notebooks/research_notebook.md;artifacts/session_info.txt;artifacts/checksums.json;artifacts/repro_report.md;artifacts/state.json,success\n2025-11-04T09:10:00Z,plan_fdr_robustness,config/agent_config.yaml;analysis/hypotheses.csv;analysis/pre_analysis_plan.md,\"Documented BH FDR command and scripted robustness automation per PAP.\",analysis/code/fdr_adjust.py,analysis/code/fdr_adjust.py;analysis/code/run_robustness_checks.py;analysis/pre_analysis_plan.md;papers/main/MANIFEST.md;notebooks/research_notebook.md;artifacts/state.json,success\n2025-11-04T09:10:00Z,plan_fdr_robustness,config/agent_config.yaml;analysis/hypotheses.csv;analysis/pre_analysis_plan.md,Documented BH FDR command and scripted robustness automation per PAP.,analysis/code/fdr_adjust.py,analysis/code/fdr_adjust.py;analysis/code/run_robustness_checks.py;analysis/pre_analysis_plan.md;papers/main/MANIFEST.md;notebooks/research_notebook.md;artifacts/state.json,success\n2025-11-04T08:19:38Z,confirmatory_run,data/clean/childhoodbalancedpublic_with_csa_indicator.csv;config/agent_config.yaml;docs/survey_design.yaml;analysis/hypotheses.csv;analysis/pre_analysis_plan.md,Executed PAP-frozen HC3 OLS for HYP-001 and HYP-003.,analysis/code/confirmatory_models.py,analysis/code/confirmatory_models.py;analysis/results.csv,success\n2025-11-04T08:19:38Z,confirmatory_run,data/clean/childhoodbalancedpublic_with_csa_indicator.csv;config/agent_config.yaml;docs/survey_design.yaml;analysis/hypotheses.csv;analysis/pre_analysis_plan.md,Executed PAP-frozen HC3 OLS for HYP-001 and HYP-003.,analysis/code/confirmatory_models.py,analysis/code/confirmatory_models.py;analysis/results.csv,success\n2025-11-04T09:25:12Z,fdr_adjust,analysis/results.csv;analysis/hypotheses.csv;config/agent_config.yaml,Applied BH q-values for confirmatory family.,analysis/code/fdr_adjust.py,analysis/results.csv;tables/fdr_adjustment_confirmatory.csv,success\n2025-11-04T09:25:34Z,robustness_checks,data/clean/childhoodbalancedpublic_with_csa_indicator.csv;config/agent_config.yaml;analysis/hypotheses.csv,Executed preregistered robustness suite for HYP-001/3.,analysis/code/run_robustness_checks.py,tables/robustness/robustness_checks_summary.csv;qc/hyp-001_helmert.md;qc/hyp-003_logit_high_anxiety.md,success\n2025-11-04T09:25:35Z,fdr_robustness_update,analysis/results.csv;analysis/hypotheses.csv;config/agent_config.yaml;data/clean/childhoodbalancedpublic_with_csa_indicator.csv,Applied BH FDR and robustness suite; refreshed narratives.,analysis/code/fdr_adjust.py;analysis/code/run_robustness_checks.py,analysis/results.csv;tables/fdr_adjustment_confirmatory.csv;tables/robustness/robustness_checks_summary.csv;reports/findings_v0.1.md;papers/main/manuscript.tex;notebooks/research_notebook.md;artifacts/state.json,success\n2025-11-04T10:45:00Z,confirmatory_synthesis,analysis/results.csv;analysis/hypotheses.csv;reports/findings_v0.1.md;papers/main_manuscript.tex,Updated confirmatory narrative and ran CSA direction diagnostics.,analysis/code/diagnose_csa_anxiety_direction.py,reports/findings_v0.2.md;papers/main/manuscript.tex;tables/diagnostics/csa_anxiety_direction.csv;qc/csa_anxiety_direction.md,success\n2025-11-04T10:45:00Z,confirmatory_synthesis,analysis/results.csv;analysis/hypotheses.csv;reports/findings_v0.1.md;papers/main/manuscript.tex,Updated confirmatory narrative and ran CSA direction diagnostics.,analysis/code/diagnose_csa_anxiety_direction.py,reports/findings_v0.2.md;papers/main/manuscript.tex;tables/diagnostics/csa_anxiety_direction.csv;qc/csa_anxiety_direction.md,success\n2025-11-04T11:05:00Z,anxiety_item_review,data/raw/childhoodbalancedpublic_original.csv;config/agent_config.yaml;docs/codebook.json,Anxiety coding/routing audit,analysis/code/review_anxiety_instrument.py,qc/anxiety_item_routing.md;tables/diagnostics/anxiety_item_review.csv,success\n", "mode": "text"}], "decision_log_row": {"ts": "2025-11-04T11:05:00Z", "action": "anxiety_item_review", "inputs": ["data/raw/childhoodbalancedpublic_original.csv", "config/agent_config.yaml", "docs/codebook.json"], "rationale_short": "Anxiety coding/routing audit", "code_path": "analysis/code/review_anxiety_instrument.py", "outputs": ["qc/anxiety_item_routing.md", "tables/diagnostics/anxiety_item_review.csv"], "status": "success"}, "next_actions": [{"id": "T-018", "priority": 3, "desc": "Contextualize CSA-anxiety findings with literature synthesis", "estimate_min": "45m"}], "state_update": {"loop_counter": 14, "last_updated": "2025-11-04T11:05:00+00:00"}, "git": {"commit": true, "message": "chore(qc): document anxiety item routing"}, "stop_now": false, "stop_reason": "", "signals": [{"type": "info", "message": "Completed T-017 anxiety instrument coding/routing review; proceeding to T-018 literature synthesis."}]}