```json
{"files":[{"path":"scripts/analyze_h2_religion_strictness_vs_happiness.py","content":"#!/usr/bin/env python3\n\"\"\"Deterministic analysis for Hypothesis H2: Childhood religious strictness vs. adult happiness change.\n\nThis script bins the ordinal childhood religious strictness scale (`externalreligion`)\ninto three deterministic terciles based on empirical distribution and reports simple\nrandom sample (SRS) means of the adult-versus-childhood happiness change item\n(`On average, I am happier as an adult than I was in childhood (h33e6gg)`).\n\nIt outputs group-level summaries and pairwise mean differences across terciles with\nBonferroni-adjusted confidence intervals while enforcing the configured minimum\ncell size for privacy.\n\"\"\"\n\nfrom __future__ import annotations\n\nimport argparse\nimport json\nimport math\nimport sys\nfrom dataclasses import dataclass\nfrom datetime import datetime, timezone\nfrom pathlib import Path\nfrom statistics import NormalDist\nfrom typing import Any, Dict, List, Optional, Sequence, Tuple\n\nimport numpy as np\nimport pandas as pd\nimport yaml\n\n\nHAPPINESS_COLUMN = \"On average, I am happier as an adult than I was in childhood (h33e6gg)\"\n\n\n@dataclass(frozen=True)\nclass AnalysisConfig:\n    seed: int\n    min_cell_size: int\n    weight_variable: Optional[str]\n    variance_method: str\n    design_assumption: str\n\n\ndef load_yaml(path: Path) -> Dict[str, Any]:\n    if not path.exists():\n        return {}\n    with path.open(\"r\", encoding=\"utf-8\") as fh:\n        return yaml.safe_load(fh) or {}\n\n\ndef resolve_seed(config: Dict[str, Any], default_seed: int = 20251016) -> int:\n    value = config.get(\"seed\", default_seed)\n    try:\n        return int(value)\n    except (TypeError, ValueError):\n        return default_seed\n\n\ndef resolve_min_cell_size(config: Dict[str, Any], override: Optional[int]) -> int:\n    if override is not None:\n        return int(override)\n    try:\n        return int(config.get(\"privacy\", {}).get(\"min_cell_size\", 10))\n    except (TypeError, ValueError):\n        return 10\n\n\ndef resolve_analysis_config(\n    agent_config_path: Path,\n    design_path: Optional[Path],\n    min_cell_override: Optional[int],\n) -> AnalysisConfig:\n    agent_cfg = load_yaml(agent_config_path)\n    design_cfg = load_yaml(design_path) if design_path else {}\n\n    seed = resolve_seed(agent_cfg)\n    min_cell = resolve_min_cell_size(agent_cfg, min_cell_override)\n    analysis_defaults = agent_cfg.get(\"analysis_defaults\", {})\n\n    weight_variable = analysis_defaults.get(\"weight_variable\")\n    variance_method = analysis_defaults.get(\"variance_method\", \"taylor\")\n    design_assumption = design_cfg.get(\n        \"design_assumption\",\n        \"Simple random sample treated as equal weights.\",\n    )\n\n    return AnalysisConfig(\n        seed=seed,\n        min_cell_size=min_cell,\n        weight_variable=weight_variable,\n        variance_method=str(variance_method),\n        design_assumption=str(design_assumption),\n    )\n\n\ndef compute_value_to_tercile_map(values: pd.Series) -> Dict[int, int]:\n    \"\"\"Assign each observed externalreligion integer value to a tercile index.\"\"\"\n    value_counts = values.value_counts(dropna=False).sort_index()\n    total = int(value_counts.sum())\n    if total == 0:\n        return {}\n\n    thresholds = [total / 3.0, 2.0 * total / 3.0]\n    value_to_group: Dict[int, int] = {}\n    cumulative = 0\n    group = 0\n\n    for raw_value, count in value_counts.items():\n        if pd.isna(raw_value):\n            continue\n        value = int(round(float(raw_value)))\n        value_to_group[value] = min(group, 2)\n        cumulative += int(count)\n        if group < 2 and cumulative >= thresholds[group]:\n            group += 1\n\n    return value_to_group\n\n\ndef build_tercile_labels(mapping: Dict[int, int]) -> Dict[int, str]:\n    grouped_values: Dict[int, List[int]] = {0: [], 1: [], 2: []}\n    for value, tercile in mapping.items():\n        grouped_values.setdefault(tercile, []).append(value)\n\n    labels: Dict[int, str] = {}\n    for idx in (0, 1, 2):\n        values = sorted(set(grouped_values.get(idx, [])))\n        if not values:\n            labels[idx] = f\"Tercile {idx + 1} (no assigned levels)\"\n        elif values[0] == values[-1]:\n            labels[idx] = f\"Tercile {idx + 1} (externalreligion = {values[0]})\"\n        else:\n            labels[idx] = (\n                f\"Tercile {idx + 1} (externalreligion in [{values[0]}, {values[-1]}])\"\n            )\n    return labels\n\n\ndef compute_group_statistics(\n    df: pd.DataFrame,\n    labels: Dict[int, str],\n    config: AnalysisConfig,\n) -> Tuple[List[Dict[str, Any]], Dict[int, Dict[str, Any]]]:\n    records: List[Dict[str, Any]] = []\n    lookup: Dict[int, Dict[str, Any]] = {}\n\n    for tercile in (0, 1, 2):\n        group_df = df.loc[df[\"strictness_tercile\"] == tercile]\n        n_total = int(group_df.shape[0])\n        base_record: Dict[str, Any] = {\n            \"tercile_index\": int(tercile),\n            \"tercile_label\": labels.get(int(tercile), f\"Tercile {tercile + 1}\"),\n            \"n_total\": n_total if n_total >= config.min_cell_size else \"suppressed_lt_10\",\n            \"seed\": config.seed,\n            \"min_cell_size\": config.min_cell_size,\n            \"weight_variable\": config.weight_variable,\n            \"variance_method\": config.variance_method,\n            \"design_assumption\": config.design_assumption,\n        }\n\n        suppressed = n_total < config.min_cell_size\n        if suppressed:\n            base_record.update(\n                {\n                    \"mean_happiness\": \"suppressed_lt_10\",\n                    \"std_happiness\": \"suppressed_lt_10\",\n                    \"se_happiness\": \"suppressed_lt_10\",\n                    \"ci_lower_95\": \"suppressed_lt_10\",\n                    \"ci_upper_95\": \"suppressed_lt_10\",\n                }\n            )\n            lookup[int(tercile)] = {\"suppressed\": True}\n            records.append(base_record)\n            continue\n\n        happiness = group_df[\"happiness\"]\n        mean_val = float(happiness.mean())\n        variance = float(happiness.var(ddof=1)) if n_total > 1 else 0.0\n        std = math.sqrt(variance)\n        se = std / math.sqrt(n_total) if n_total > 0 else float(\"nan\")\n        ci_margin = 1.96 * se\n\n        base_record.update(\n            {\n                \"mean_happiness\": round(mean_val, 6),\n                \"std_happiness\": round(std, 6),\n                \"se_happiness\": round(se, 6),\n                \"ci_lower_95\": round(mean_val - ci_margin, 6),\n                \"ci_upper_95\": round(mean_val + ci_margin, 6),\n            }\n        )\n        records.append(base_record)\n        lookup[int(tercile)] = {\n            \"suppressed\": False,\n            \"n\": n_total,\n            \"mean\": mean_val,\n            \"variance\": variance,\n            \"label\": labels.get(int(tercile), f\"Tercile {tercile + 1}\"),\n        }\n\n    return records, lookup\n\n\ndef compute_pairwise_differences(\n    lookup: Dict[int, Dict[str, Any]],\n    config: AnalysisConfig,\n) -> List[Dict[str, Any]]:\n    comparisons = [\n        (0, 1, \"Tercile 2 minus Tercile 1\"),\n        (0, 2, \"Tercile 3 minus Tercile 1\"),\n        (1, 2, \"Tercile 3 minus Tercile 2\"),\n    ]\n    results: List[Dict[str, Any]] = []\n    alpha = 0.05 / max(len(comparisons), 1)\n    z_crit = NormalDist().inv_cdf(1 - alpha / 2.0)\n\n    for lower, upper, label in comparisons:\n        record: Dict[str, Any] = {\n            \"comparison\": label,\n            \"group_low_index\": lower,\n            \"group_high_index\": upper,\n            \"seed\": config.seed,\n            \"min_cell_size\": config.min_cell_size,\n            \"weight_variable\": config.weight_variable,\n            \"variance_method\": config.variance_method,\n            \"design_assumption\": config.design_assumption,\n            \"bonferroni_alpha\": round(alpha, 6),\n            \"z_critical\": round(z_crit, 6),\n        }\n\n        group_low = lookup.get(lower)\n        group_high = lookup.get(upper)\n\n        if not group_low or not group_high:\n            record.update(\n                {\n                    \"estimate\": \"insufficient_group\",\n                    \"standard_error\": \"insufficient_group\",\n                    \"ci_lower\": \"insufficient_group\",\n                    \"ci_upper\": \"insufficient_group\",\n                }\n            )\n            results.append(record)\n            continue\n\n        if group_low.get(\"suppressed\") or group_high.get(\"suppressed\"):\n            record.update(\n                {\n                    \"estimate\": \"suppressed_lt_10\",\n                    \"standard_error\": \"suppressed_lt_10\",\n                    \"ci_lower\": \"suppressed_lt_10\",\n                    \"ci_upper\": \"suppressed_lt_10\",\n                }\n            )\n            results.append(record)\n            continue\n\n        mean_diff = group_high[\"mean\"] - group_low[\"mean\"]\n        n_low = group_low[\"n\"]\n        n_high = group_high[\"n\"]\n        var_low = group_low[\"variance\"]\n        var_high = group_high[\"variance\"]\n        se = math.sqrt((var_low / n_low) + (var_high / n_high))\n        ci_margin = z_crit * se\n\n        record.update(\n            {\n                \"estimate\": round(mean_diff, 6),\n                \"standard_error\": round(se, 6),\n                \"ci_lower\": round(mean_diff - ci_margin, 6),\n                \"ci_upper\": round(mean_diff + ci_margin, 6),\n                \"group_low_label\": group_low.get(\"label\"),\n                \"group_high_label\": group_high.get(\"label\"),\n                \"n_group_low\": n_low,\n                \"n_group_high\": n_high,\n            }\n        )\n        results.append(record)\n\n    return results\n\n\ndef parse_args(argv: Optional[Sequence[str]] = None) -> argparse.Namespace:\n    parser = argparse.ArgumentParser(\n        description=\"Compute deterministic SRS means for Hypothesis H2 (religious strictness terciles vs happiness change).\"\n    )\n    parser.add_argument(\"--csv\", required=True, help=\"Path to the survey CSV file.\")\n    parser.add_argument(\"--config\", required=True, help=\"Path to the agent configuration YAML.\")\n    parser.add_argument(\n        \"--design\",\n        required=False,\n        help=\"Optional path to survey design YAML for metadata inclusion.\",\n    )\n    parser.add_argument(\"--out\", required=True, help=\"Output CSV path for tercile-level statistics.\")\n    parser.add_argument(\n        \"--diff-out\",\n        required=True,\n        help=\"Output CSV path for pairwise mean differences across terciles.\",\n    )\n    parser.add_argument(\"--manifest\", required=True, help=\"Output JSON manifest path.\")\n    parser.add_argument(\n        \"--min-cell\",\n        type=int,\n        default=None,\n        help=\"Override minimum cell size (defaults to config privacy.min_cell_size).\",\n    )\n    return parser.parse_args(argv)\n\n\ndef main(argv: Optional[Sequence[str]] = None) -> None:\n    args = parse_args(argv)\n    csv_path = Path(args.csv)\n    config_path = Path(args.config)\n    design_path = Path(args.design) if args.design else None\n    out_path = Path(args.out)\n    diff_path = Path(args.diff_out)\n    manifest_path = Path(args.manifest)\n\n    analysis_config = resolve_analysis_config(config_path, design_path, args.min_cell)\n    np.random.seed(analysis_config.seed)\n\n    required_columns = [\"externalreligion\", HAPPINESS_COLUMN]\n    df = pd.read_csv(csv_path, usecols=required_columns)\n    df_clean = df.dropna(subset=required_columns).copy()\n    df_clean[\"externalreligion\"] = df_clean[\"externalreligion\"].astype(int)\n    df_clean[\"happiness\"] = df_clean[HAPPINESS_COLUMN].astype(float)\n\n    value_map = compute_value_to_tercile_map(df_clean[\"externalreligion\"])\n    if len(value_map) == 0:\n        raise ValueError(\"No observed values for externalreligion to form terciles.\")\n    labels = build_tercile_labels(value_map)\n\n    df_clean[\"strictness_tercile\"] = df_clean[\"externalreligion\"].map(value_map)\n    raw_counts = df_clean[\"strictness_tercile\"].value_counts().to_dict()\n    tercile_counts = {idx: int(raw_counts.get(idx, 0)) for idx in (0, 1, 2)}\n\n    out_path.parent.mkdir(parents=True, exist_ok=True)\n    diff_path.parent.mkdir(parents=True, exist_ok=True)\n    manifest_path.parent.mkdir(parents=True, exist_ok=True)\n\n    group_records, lookup = compute_group_statistics(df_clean, labels, analysis_config)\n    group_df = pd.DataFrame(group_records)\n    group_df.to_csv(out_path, index=False)\n\n    diff_records = compute_pairwise_differences(lookup, analysis_config)\n    diff_df = pd.DataFrame(diff_records)\n    diff_df.to_csv(diff_path, index=False)\n\n    manifest = {\n        \"analysis\": \"H2: Childhood religious strictness vs adult happiness change\",\n        \"seed\": analysis_config.seed,\n        \"min_cell_size\": analysis_config.min_cell_size,\n        \"dataset\": str(csv_path),\n        \"config\": str(config_path),\n        \"design\": str(design_path) if design_path else None,\n        \"command\": \"python \" + \" \".join(sys.argv[0:]),\n        \"timestamp_utc\": datetime.now(timezone.utc).isoformat(),\n        \"outputs\": {\n            \"tercile_stats_csv\": str(out_path),\n            \"differences_csv\": str(diff_path),\n        },\n        \"weight_variable\": analysis_config.weight_variable,\n        \"variance_method\": analysis_config.variance_method,\n        \"design_assumption\": analysis_config.design_assumption,\n        \"tercile_value_map\": value_map,\n        \"tercile_labels\": labels,\n        \"tercile_counts\": {int(k): int(v) for k, v in tercile_counts.items()},\n        \"happiness_column\": HAPPINESS_COLUMN,\n    }\n    with manifest_path.open(\"w\", encoding=\"utf-8\") as fh:\n        json.dump(manifest, fh, indent=2, sort_keys=True)\n\n\nif __name__ == \"__main__\":\n    main()\n","mode":"text"},{"path":"tables/h2_happiness_by_religion_strictness.csv","content":"tercile_index,tercile_label,n_total,seed,min_cell_size,weight_variable,variance_method,design_assumption,mean_happiness,std_happiness,se_happiness,ci_lower_95,ci_upper_95\n0,Tercile 1 (externalreligion = 0),5224,20251016,10,,taylor,Treat as simple random sample until sponsor provides design metadata.,0.778905,1.935967,0.026785,0.726406,0.831404\n1,\"Tercile 2 (externalreligion in [1, 2])\",5801,20251016,10,,taylor,Treat as simple random sample until sponsor provides design metadata.,0.675056,1.956002,0.025681,0.624721,0.725391\n2,\"Tercile 3 (externalreligion in [3, 4])\",3411,20251016,10,,taylor,Treat as simple random sample until sponsor provides design metadata.,0.818821,1.942731,0.033264,0.753624,0.884018\n","mode":"text"},{"path":"tables/h2_happiness_by_religion_strictness_diff.csv","content":"comparison,group_low_index,group_high_index,seed,min_cell_size,weight_variable,variance_method,design_assumption,bonferroni_alpha,z_critical,estimate,standard_error,ci_lower,ci_upper,group_low_label,group_high_label,n_group_low,n_group_high\nTercile 2 minus Tercile 1,0,1,20251016,10,,taylor,Treat as simple random sample until sponsor provides design metadata.,0.016667,2.39398,-0.103849,0.037108,-0.192684,-0.015014,Tercile 1 (externalreligion = 0),\"Tercile 2 (externalreligion in [1, 2])\",5224,5801\nTercile 3 minus Tercile 1,0,2,20251016,10,,taylor,Treat as simple random sample until sponsor provides design metadata.,0.016667,2.39398,0.039916,0.042708,-0.062325,0.142157,Tercile 1 (externalreligion = 0),\"Tercile 3 (externalreligion in [3, 4])\",5224,3411\nTercile 3 minus Tercile 2,1,2,20251016,10,,taylor,Treat as simple random sample until sponsor provides design metadata.,0.016667,2.39398,0.143765,0.042024,0.043161,0.24437,\"Tercile 2 (externalreligion in [1, 2])\",\"Tercile 3 (externalreligion in [3, 4])\",5801,3411\n","mode":"text"},{"path":"artifacts/h2_religion_strictness_vs_happiness_manifest.json","content":"{\n  \"analysis\": \"H2: Childhood religious strictness vs adult happiness change\",\n  \"command\": \"python scripts/analyze_h2_religion_strictness_vs_happiness.py --csv childhoodbalancedpublic_original.csv --config config/agent_config.yaml --design docs/survey_design.yaml --out tables/h2_happiness_by_religion_strictness.csv --diff-out tables/h2_happiness_by_religion_strictness_diff.csv --manifest artifacts/h2_religion_strictness_vs_happiness_manifest.json\",\n  \"config\": \"config/agent_config.yaml\",\n  \"dataset\": \"childhoodbalancedpublic_original.csv\",\n  \"design\": \"docs/survey_design.yaml\",\n  \"design_assumption\": \"Treat as simple random sample until sponsor provides design metadata.\",\n  \"happiness_column\": \"On average, I am happier as an adult than I was in childhood (h33e6gg)\",\n  \"min_cell_size\": 10,\n  \"outputs\": {\n    \"differences_csv\": \"tables/h2_happiness_by_religion_strictness_diff.csv\",\n    \"tercile_stats_csv\": \"tables/h2_happiness_by_religion_strictness.csv\"\n  },\n  \"seed\": 20251016,\n  \"tercile_counts\": {\n    \"0\": 5224,\n    \"1\": 5801,\n    \"2\": 3411\n  },\n  \"tercile_labels\": {\n    \"0\": \"Tercile 1 (externalreligion = 0)\",\n    \"1\": \"Tercile 2 (externalreligion in [1, 2])\",\n    \"2\": \"Tercile 3 (externalreligion in [3, 4])\"\n  },\n  \"tercile_value_map\": {\n    \"0\": 0,\n    \"1\": 1,\n    \"2\": 1,\n    \"3\": 2,\n    \"4\": 2\n  },\n  \"timestamp_utc\": \"2025-11-04T08:08:42.074184+00:00\",\n  \"variance_method\": \"taylor\",\n  \"weight_variable\": null\n}","mode":"text"},{"path":"analysis/hypotheses.csv","content":"hypothesis_id,hypothesis_text,priority,variables,status,notes\nH-001,\"Active religious practice rates differ by biological sex.\",1,\"['biomale','religion']\",in_progress,\"Religion recoded as any value >0 for active practice; SRS assumption.\"\nH-002,\"Higher childhood religious strictness associates with greater adult happiness change.\",2,\"['externalreligion','On average, I am happier as an adult than I was in childhood (h33e6gg)']\",in_progress,\"Deterministic script scripts/analyze_h2_religion_strictness_vs_happiness.py exports tables/h2_happiness_by_religion_strictness.csv and manifest artifacts/h2_religion_strictness_vs_happiness_manifest.json.\"\nH-003,\"Net worth brackets correlate with work/career satisfaction.\",3,\"['networth','I am satisfied with my work/career life (z0mhd63)']\",draft,\"Will explore ordinal associations after weight confirmation.\"\nH-004,\"Self-reported depression tendency aligns with stress sensitivity.\",3,\"['I tend to suffer from depression (wz901dj)','I'm quite sensitive to stress (qhyti2r)-neg']\",draft,\"Requires scale harmonization and privacy review.\"\nH-005,\"Older respondents report higher counts of lifetime sexual partners.\",3,\"['selfage','How many people have you had sex with? (ewvvaz2)']\",draft,\"Assess monotonic trend with count models under SRS assumption.\"\n","mode":"text"},{"path":"analysis/pre_analysis_plan.md","content":"# Pre-Analysis Plan (Draft)\n\n**Seed:** 20251016  \n**Regeneration command:** `python scripts/bootstrap_artifacts.py`\n\n## Project Overview\nThis document sketches the initial analytic roadmap for the childhood balance public survey. It is a living draft that will be versioned until the PAP is frozen. The plan prioritizes reproducibility, privacy (minimum cell size = 10), and alignment between Markdown deliverables and the future LaTeX manuscript (`manuscript.tex`).\n\n## Data & Design Inputs\n- Primary dataset: `childhoodbalancedpublic_original.csv` (read-only source).\n- Metadata: `docs/codebook.json` (variable stubs) and `docs/survey_design.yaml` (design placeholders).\n- Weighting: pending confirmation of the final weight variable. Analyses will default to unweighted diagnostic checks until `weight_variable` is populated, after which all estimates will be weighted.\n\n## Candidate Hypotheses (Descriptive/Associational)\n1. **H-A:** The weighted proportion of respondents who currently practice a religion (`religion`) differs by biological sex (`biomale`).\n2. **H-B:** Greater reported importance of childhood religious adherence (`externalreligion`) is associated with higher adult happiness relative to childhood (`I am happier as an adult than I was in childhood (h33e6gg)`).\n3. **H-C:** Respondents reporting higher current net worth brackets (`networth`) are more satisfied with their work or career (`I am satisfied with my work/career life (z0mhd63)`).\n4. **H-D:** Self-reported depression tendency (`I tend to suffer from depression (wz901dj)`) is positively associated with stress sensitivity (`I'm quite sensitive to stress (qhyti2r)-neg`).\n5. **H-E:** Older respondents (`selfage`) report higher counts of lifetime sexual partners (`How many people have you had sex with? (ewvvaz2)`).\n\n## Priority Hypotheses for Immediate Work\n### H1 (Priority: High)\n- **Statement:** The weighted proportion of active religious practice (`religion`) varies by biological sex (`biomale`).\n- **Estimand:** Difference in weighted proportions male vs. non-male.\n- **Approach:**\n  - Confirm weight and design variables from `docs/survey_design.yaml`.\n  - Recode `religion` as an indicator for any active practice (`religion > 0`) to align with survey response gradations.\n  - Use survey-weighted proportion estimates with 95% confidence intervals (Taylor linearization initially).\n  - Apply privacy guardrails by suppressing any subgroup estimate with n < 10.\n  - Implement deterministic workflow via `python scripts/analyze_h1_religion_by_biomale.py --csv childhoodbalancedpublic_original.csv --config config/agent_config.yaml --design docs/survey_design.yaml --out tables/h1_religion_by_biomale.csv --diff-out tables/h1_religion_by_biomale_diff.csv --manifest artifacts/h1_religion_by_biomale_manifest.json`.\n- **Diagnostics:** Assess missingness in `religion` and `biomale`; compare unweighted vs. weighted proportions.\n\n### H2 (Priority: Medium)\n- **Statement:** Higher childhood religious strictness (`externalreligion`) is associated with greater adult happiness change (`h33e6gg`).\n- **Estimand:** Survey-weighted difference in mean adult-vs-childhood happiness scores across terciles of `externalreligion`.\n- **Approach:**\n  - Confirm scale direction for both variables using the codebook.\n  - Construct deterministic terciles of `externalreligion` via ordinal breakpoints (0 | 1-2 | 3-4) under SRS assumptions.\n  - Estimate SRS means and Bonferroni-adjusted pairwise differences for `On average, I am happier as an adult than I was in childhood (h33e6gg)`.\n  - Suppress cells where any tercile has <10 observations contributing to the estimate.\n  - Regeneration command (seed=20251016):  \n    `python scripts/analyze_h2_religion_strictness_vs_happiness.py --csv childhoodbalancedpublic_original.csv --config config/agent_config.yaml --design docs/survey_design.yaml --out tables/h2_happiness_by_religion_strictness.csv --diff-out tables/h2_happiness_by_religion_strictness_diff.csv --manifest artifacts/h2_religion_strictness_vs_happiness_manifest.json`\n- **Diagnostics:** Explore missing data patterns and perform sensitivity checks with unweighted comparisons.\n\n## Analysis Workflow Outline\n1. Validate design information (`T-001`).\n2. Produce weighted descriptive summaries for variables in H1 and H2 (`T-002`).\n3. Generate deterministic H1 proportion estimates via `scripts/analyze_h1_religion_by_biomale.py` and archive manifests.\n4. Draft shell scripts for deterministic data processing once design metadata confirmed.\n5. Update manuscript (`manuscript.tex`) after each major analytic milestone to mirror Markdown findings.\n\n## Privacy and Quality Control\n- Enforce minimum cell size of 10 in all tables and plots.\n- Document QA steps in `qc/data_checks.md` with pass/fail status and regeneration commands.\n- Use deterministic seeds for any resampling or imputation; record seeds alongside outputs.\n\n## Manuscript Coordination\n- Maintain synchronized updates between Markdown narratives (e.g., `reports/`) and `manuscript.tex`.\n- Record versioned changes in git immediately after producing major artifacts (state updates, PAP revisions, hypotheses registry adjustments).\n\n## Outstanding TODOs Before Freezing PAP\n- Populate `docs/codebook.json` with full variable metadata.\n- Confirm survey design elements and update `config/agent_config.yaml` defaults.\n- Prototype analysis scripts to automate the above regeneration command.\n- Revisit hypotheses list after exploratory summaries to ensure feasibility and refine estimands.\n","mode":"text"},{"path":"notebooks/research_notebook.md","content":"# Research Notebook (Bootstrap Scaffold)\n\n**Seed:** 20251016  \n**Regeneration command:** `python scripts/bootstrap_artifacts.py`\n\n## Session 0 Overview\n- Initialized repository structure and placeholder metadata files.\n- Documented initial hypotheses and PAP priorities (see `analysis/pre_analysis_plan.md`).\n- Recorded backlog items in `artifacts/state.json`.\n\n## Planned Next Entries\n1. Run exploratory weighted summaries for religion and happiness variables.\n2. Document QA checks and sync findings with `manuscript.tex`.\n3. Monitor sponsor communications for survey design metadata updates.\n\n> Update this notebook after each analysis loop with commands run, seeds used, and outputs generated.\n\n## Loop 1 - Survey Design Validation\n\n- **Commands:**  \n  - `python scripts/design_scan.py --csv childhoodbalancedpublic_original.csv`  \n  - `python - <<'PY'` (counts rows; see `qc/design_validation.md`)\n- **Seed:** 20251016 (inherited; no stochastic procedures invoked).\n- **Outcome:** No survey weight, strata, cluster, or replicate columns detected. Updated `docs/survey_design.yaml`, `config/agent_config.yaml`, and `qc/data_checks.md`; recorded findings in `qc/design_validation.md`.\n\n## Loop 2 - Exploratory Summaries for Key Outcomes\n\n- **Commands:**  \n  - `python scripts/exploratory_summaries.py --csv childhoodbalancedpublic_original.csv --config config/agent_config.yaml --out tables/summary_key_outcomes.csv`\n- **Seed:** 20251016 (deterministic computation; no stochastic elements beyond fixed seed).\n- **Outputs:** `tables/summary_key_outcomes.csv`, `tables/summary_key_outcomes.json`\n- **Notes:** Generated unweighted descriptive statistics for priority outcomes because calibrated survey weights remain unavailable. All reported cells meet the minimum count threshold (>=10) enforced within the script.\n\n## Loop 3 - Sponsor Design Metadata Monitoring\n\n- **Commands:**  \n  - `python scripts/design_scan.py --csv childhoodbalancedpublic_original.csv`\n- **Seed:** 20251016 (deterministic scan; no randomness invoked).\n- **Outcome:** Confirmed no new sponsor-provided survey design metadata files. Script matches only questionnaire columns containing \"weight\" or \"jk\" substrings; none correspond to calibrated weights or replicate designs. See `qc/design_metadata_monitor.md` for details.\n\n## Loop 6 - H1 Religion by Sex Estimates\n\n- **Commands:**  \n  - `python scripts/analyze_h1_religion_by_biomale.py --csv childhoodbalancedpublic_original.csv --config config/agent_config.yaml --design docs/survey_design.yaml --out tables/h1_religion_by_biomale.csv --diff-out tables/h1_religion_by_biomale_diff.csv --manifest artifacts/h1_religion_by_biomale_manifest.json`\n- **Seed:** 20251016 (set via config; analysis deterministic under SRS assumption).\n- **Outputs:** `tables/h1_religion_by_biomale.csv`, `tables/h1_religion_by_biomale_diff.csv`, `artifacts/h1_religion_by_biomale_manifest.json`.\n- **Notes:** Recast `religion` responses into an \"any practice\" indicator (`religion > 0`). The SRS-based estimate indicates non-male respondents practice religion at a higher rate than male respondents (difference ≈ -0.058, 95% CI [-0.074, -0.043]). All subgroup counts exceed the privacy threshold (>=10).\n\n## Loop 7 - H2 Religion Strictness vs Happiness\n\n- **Commands:**  \n  - `python scripts/analyze_h2_religion_strictness_vs_happiness.py --csv childhoodbalancedpublic_original.csv --config config/agent_config.yaml --design docs/survey_design.yaml --out tables/h2_happiness_by_religion_strictness.csv --diff-out tables/h2_happiness_by_religion_strictness_diff.csv --manifest artifacts/h2_religion_strictness_vs_happiness_manifest.json`\n- **Seed:** 20251016 (deterministic SRS means; no additional randomness).\n- **Outputs:** `tables/h2_happiness_by_religion_strictness.csv`, `tables/h2_happiness_by_religion_strictness_diff.csv`, `artifacts/h2_religion_strictness_vs_happiness_manifest.json`.\n- **Notes:** Ordinal `externalreligion` values were partitioned into terciles (0 | 1-2 | 3-4) using deterministic cumulative counts. Mean adult-vs-childhood happiness scores rise from Tercile 2 to Tercile 3 (difference ≈ 0.144, Bonferroni-adjusted 95% CI [0.043, 0.244]) while Tercile 1 exceeds Tercile 2 by ≈0.104 in the negative direction. All reported cells satisfy the minimum n ≥ 10 privacy guardrail.\n","mode":"text"},{"path":"artifacts/state.json","content":"{\n  \"artifacts\": {\n    \"design_metadata_brief\": \"reports/design_metadata_brief.md\",\n    \"h1_difference\": \"tables/h1_religion_by_biomale_diff.csv\",\n    \"h1_group_stats\": \"tables/h1_religion_by_biomale.csv\",\n    \"h1_manifest\": \"artifacts/h1_religion_by_biomale_manifest.json\",\n    \"h2_differences\": \"tables/h2_happiness_by_religion_strictness_diff.csv\",\n    \"h2_group_stats\": \"tables/h2_happiness_by_religion_strictness.csv\",\n    \"h2_manifest\": \"artifacts/h2_religion_strictness_vs_happiness_manifest.json\",\n    \"hypotheses_registry\": \"analysis/hypotheses.csv\",\n    \"pre_analysis_plan\": \"analysis/pre_analysis_plan.md\",\n    \"research_notebook\": \"notebooks/research_notebook.md\"\n  },\n  \"backlog\": [\n    {\n      \"description\": \"Validate survey weights and replicate design metadata\",\n      \"id\": \"T-001\",\n      \"priority\": 1,\n      \"status\": \"done\"\n    },\n    {\n      \"description\": \"Generate exploratory weighted summaries for key outcomes\",\n      \"id\": \"T-002\",\n      \"priority\": 2,\n      \"status\": \"done\"\n    },\n    {\n      \"description\": \"Monitor for sponsor-provided survey design metadata updates\",\n      \"id\": \"T-003\",\n      \"priority\": 3,\n      \"status\": \"done\"\n    },\n    {\n      \"description\": \"Draft sponsor-ready brief summarizing design metadata gaps and needed files\",\n      \"id\": \"T-004\",\n      \"priority\": 3,\n      \"status\": \"done\"\n    },\n    {\n      \"description\": \"Follow up with sponsor on requested design deliverables\",\n      \"id\": \"T-005\",\n      \"priority\": 1,\n      \"status\": \"done\"\n    },\n    {\n      \"description\": \"Update design files upon receipt of sponsor metadata\",\n      \"id\": \"T-006\",\n      \"priority\": 3,\n      \"status\": \"blocked\"\n    },\n    {\n      \"description\": \"Estimate H1 active religion practice rates by biological sex\",\n      \"id\": \"T-007\",\n      \"priority\": 2,\n      \"status\": \"done\"\n    },\n    {\n      \"description\": \"Develop H2 analysis script for religion strictness vs adult happiness change\",\n      \"id\": \"T-008\",\n      \"priority\": 1,\n      \"status\": \"done\"\n    },\n    {\n      \"description\": \"Update manuscript and reports with design context and H1 findings\",\n      \"id\": \"T-009\",\n      \"priority\": 2,\n      \"status\": \"todo\"\n    },\n    {\n      \"description\": \"Summarize H2 findings and integrate into manuscript drafts\",\n      \"id\": \"T-010\",\n      \"priority\": 2,\n      \"status\": \"todo\"\n    }\n  ],\n  \"bootstrap_complete\": true,\n  \"loop_counter\": 7,\n  \"next_actions\": [\n    {\n      \"desc\": \"Update manuscript and reports with design context, H1, and H2 findings\",\n      \"estimate_min\": \"40m\",\n      \"id\": \"T-009\",\n      \"priority\": 1\n    },\n    {\n      \"desc\": \"Summarize H2 findings for manuscript integration\",\n      \"estimate_min\": \"35m\",\n      \"id\": \"T-010\",\n      \"priority\": 2\n    }\n  ],\n  \"regeneration_commands\": {\n    \"bootstrap\": \"python scripts/bootstrap_artifacts.py\",\n    \"design_brief\": \"python scripts/generate_design_brief.py --out reports/design_metadata_brief.md\",\n    \"design_monitoring\": \"python scripts/design_scan.py --csv childhoodbalancedpublic_original.csv\",\n    \"design_validation\": \"python scripts/design_scan.py --csv childhoodbalancedpublic_original.csv\",\n    \"exploratory_summaries\": \"python scripts/exploratory_summaries.py --csv childhoodbalancedpublic_original.csv --config config/agent_config.yaml --out tables/summary_key_outcomes.csv\",\n    \"h1_religion_analysis\": \"python scripts/analyze_h1_religion_by_biomale.py --csv childhoodbalancedpublic_original.csv --config config/agent_config.yaml --design docs/survey_design.yaml --out tables/h1_religion_by_biomale.csv --diff-out tables/h1_religion_by_biomale_diff.csv --manifest artifacts/h1_religion_by_biomale_manifest.json\",\n    \"h2_religion_analysis\": \"python scripts/analyze_h2_religion_strictness_vs_happiness.py --csv childhoodbalancedpublic_original.csv --config config/agent_config.yaml --design docs/survey_design.yaml --out tables/h2_happiness_by_religion_strictness.csv --diff-out tables/h2_happiness_by_religion_strictness_diff.csv --manifest artifacts/h2_religion_strictness_vs_happiness_manifest.json\",\n    \"sponsor_follow_up\": \"python scripts/generate_sponsor_follow_up.py --brief reports/design_metadata_brief.md --out reports/sponsor_follow_up.md\"\n  },\n  \"seed\": 20251016,\n  \"total_loops\": 30\n}\n","mode":"text"}],"decision_log_row":{"ts":"2025-11-04T08:12:32Z","action":"loop","inputs":["childhoodbalancedpublic_original.csv","config/agent_config.yaml","docs/survey_design.yaml"],"rationale_short":"Developed deterministic H2 tercile analysis, recorded outputs, updated state.","code_path":"scripts/analyze_h2_religion_strictness_vs_happiness.py","outputs":["tables/h2_happiness_by_religion_strictness.csv","tables/h2_happiness_by_religion_strictness_diff.csv","artifacts/h2_religion_strictness_vs_happiness_manifest.json"],"status":"success"},"next_actions":[{"id":"T-009","priority":1,"desc":"Update manuscript and reports with design context, H1, and H2 findings","estimate_min":"40m"},{"id":"T-010","priority":2,"desc":"Summarize H2 findings for manuscript integration","estimate_min":"35m"}],"state_update":{"loop_counter":7,"artifacts":{"design_metadata_brief":"reports/design_metadata_brief.md","h1_difference":"tables/h1_religion_by_biomale_diff.csv","h1_group_stats":"tables/h1_religion_by_biomale.csv","h1_manifest":"artifacts/h1_religion_by_biomale_manifest.json","h2_differences":"tables/h2_happiness_by_religion_strictness_diff.csv","h2_group_stats":"tables/h2_happiness_by_religion_strictness.csv","h2_manifest":"artifacts/h2_religion_strictness_vs_happiness_manifest.json","hypotheses_registry":"analysis/hypotheses.csv","pre_analysis_plan":"analysis/pre_analysis_plan.md","research_notebook":"notebooks/research_notebook.md"},"backlog":[{"description":"Validate survey weights and replicate design metadata","id":"T-001","priority":1,"status":"done"},{"description":"Generate exploratory weighted summaries for key outcomes","id":"T-002","priority":2,"status":"done"},{"description":"Monitor for sponsor-provided survey design metadata updates","id":"T-003","priority":3,"status":"done"},{"description":"Draft sponsor-ready brief summarizing design metadata gaps and needed files","id":"T-004","priority":3,"status":"done"},{"description":"Follow up with sponsor on requested design deliverables","id":"T-005","priority":1,"status":"done"},{"description":"Update design files upon receipt of sponsor metadata","id":"T-006","priority":3,"status":"blocked"},{"description":"Estimate H1 active religion practice rates by biological sex","id":"T-007","priority":2,"status":"done"},{"description":"Develop H2 analysis script for religion strictness vs adult happiness change","id":"T-008","priority":1,"status":"done"},{"description":"Update manuscript and reports with design context and H1 findings","id":"T-009","priority":2,"status":"todo"},{"description":"Summarize H2 findings and integrate into manuscript drafts","id":"T-010","priority":2,"status":"todo"}],"next_actions":[{"desc":"Update manuscript and reports with design context, H1, and H2 findings","estimate_min":"40m","id":"T-009","priority":1},{"desc":"Summarize H2 findings for manuscript integration","estimate_min":"35m","id":"T-010","priority":2}],"regeneration_commands":{"bootstrap":"python scripts/bootstrap_artifacts.py","design_brief":"python scripts/generate_design_brief.py --out reports/design_metadata_brief.md","design_monitoring":"python scripts/design_scan.py --csv childhoodbalancedpublic_original.csv","design_validation":"python scripts/design_scan.py --csv childhoodbalancedpublic_original.csv","exploratory_summaries":"python scripts/exploratory_summaries.py --csv childhoodbalancedpublic_original.csv --config config/agent_config.yaml --out tables/summary_key_outcomes.csv","h1_religion_analysis":"python scripts/analyze_h1_religion_by_biomale.py --csv childhoodbalancedpublic_original.csv --config config/agent_config.yaml --design docs/survey_design.yaml --out tables/h1_religion_by_biomale.csv --diff-out tables/h1_religion_by_biomale_diff.csv --manifest artifacts/h1_religion_by_biomale_manifest.json","h2_religion_analysis":"python scripts/analyze_h2_religion_strictness_vs_happiness.py --csv childhoodbalancedpublic_original.csv --config config/agent_config.yaml --design docs/survey_design.yaml --out tables/h2_happiness_by_religion_strictness.csv --diff-out tables/h2_happiness_by_religion_strictness_diff.csv --manifest artifacts/h2_religion_strictness_vs_happiness_manifest.json","sponsor_follow_up":"python scripts/generate_sponsor_follow_up.py --brief reports/design_metadata_brief.md --out reports/sponsor_follow_up.md"}},"git":{"commit":true,"message":"feat(h2): add religion strictness happiness analysis pipeline"},"stop_now":false,"stop_reason":"","signals":["loop7_complete","h2_analysis_script_generated"]}
```