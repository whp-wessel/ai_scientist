{
  "files": [
    {
      "path": "scripts/generate_sponsor_follow_up.py",
      "content": "#!/usr/bin/env python3\n\"\"\"\nGenerate a sponsor follow-up note requesting outstanding survey design deliverables.\n\nThe content is derived from the latest design metadata brief so the request stays\naligned with previously logged gaps. The script is deterministic aside from the\ntimestamp, which is recorded for transparency. Seed is logged for reproducibility.\n\"\"\"\n\nimport argparse\nimport pathlib\nimport re\nimport sys\nfrom datetime import UTC, datetime\nfrom typing import List, Optional\n\nSEED = 20251016\n\n\ndef _read_text(path: pathlib.Path) -> str:\n    if not path.exists():\n        raise FileNotFoundError(f\"Expected brief at {path}\")\n    return path.read_text(encoding=\"utf-8\")\n\n\ndef _extract_dataset(markdown: str) -> Optional[str]:\n    match = re.search(r\"-\\s*Dataset:\\s*`([^`]+)`\", markdown)\n    return match.group(1) if match else None\n\n\ndef _extract_bullets(markdown: str, heading: str) -> List[str]:\n    lines = markdown.splitlines()\n    capture = False\n    bullets: List[str] = []\n    for line in lines:\n        if line.startswith(\"## \"):\n            if capture and line.strip() != f\"## {heading}\":\n                break\n            capture = line.strip() == f\"## {heading}\"\n            continue\n        if capture and line.startswith(\"- \"):\n            bullets.append(line[2:].strip())\n    return bullets\n\n\ndef build_follow_up(brief_markdown: str, brief_path: pathlib.Path) -> str:\n    dataset = _extract_dataset(brief_markdown) or \"the study dataset\"\n    requested = _extract_bullets(brief_markdown, \"Requested Sponsor Deliverables\")\n    gaps = _extract_bullets(brief_markdown, \"Metadata Gaps\")\n\n    generated_ts = datetime.now(UTC).replace(microsecond=0).isoformat()\n\n    email_lines: List[str] = [\n        \"# Sponsor Follow-up: Survey Design Deliverables\",\n        \"\",\n        f\"- Generated: {generated_ts}\",\n        f\"- Seed: {SEED}\",\n        f\"- Source brief: {brief_path.as_posix()}\",\n        \"\",\n        \"## Email Draft\",\n        \"Subject: Follow-up on Survey Design Deliverables for Childhood Balanced Study\",\n        \"\",\n        \"Hello [Sponsor Team],\",\n        \"\",\n        \"Thank you for your partnership on the Childhood Balanced Study. \"\n        \"Following our earlier brief, we still need the survey design metadata \"\n        \"below to finalize weighting and variance estimation protocols. \"\n        \"Could you please share the outstanding items or an estimated delivery date?\",\n        \"\",\n        \"Outstanding deliverables:\",\n        *[f\"- {item}\" for item in requested],\n        \"\",\n        \"Once we receive these files we can update the survey design metadata, rerun \"\n        \"the validation scripts, and confirm that the weighting specifications align \"\n        \"with your production workflow. Please let us know if any of the items have \"\n        \"changed or if additional context is required.\",\n        \"\",\n        \"Best regards,\",\n        \"\",\n        \"[Research Automation Team]\",\n        \"\",\n        \"## Talking Points for Follow-up Call\",\n        *[f\"- {gap}\" for gap in gaps],\n        \"\",\n        \"## Attachments/References\",\n        f\"- Latest design brief: {brief_path.as_posix()}