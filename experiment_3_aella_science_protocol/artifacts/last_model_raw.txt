```json
{
  "files": [
    {
      "path": "analysis/code/confirmatory_models.py",
      "content": "#!/usr/bin/env python3\n\"\"\"\nExecute pre-registered confirmatory models for the childhood balanced public survey.\n\nReproducibility\n--------------\nAll randomness is seeded by `config/agent_config.yaml` (seed=20251016).\nRegenerate provisional confirmatory estimates via:\n\n    python analysis/code/confirmatory_models.py \\\n        --dataset data/clean/childhoodbalancedpublic_with_csa_indicator.csv \\\n        --config config/agent_config.yaml \\\n        --survey-design docs/survey_design.yaml \\\n        --results-csv analysis/results.csv \\\n        --hypotheses HYP-001 HYP-003\n\nThe script is deterministic given identical inputs and environment.\n\"\"\"\n\nfrom __future__ import annotations\n\nimport argparse\nimport logging\nimport random\nimport re\nfrom dataclasses import dataclass\nfrom datetime import datetime, timezone\nfrom pathlib import Path\nfrom typing import Dict, Iterable, List, Sequence\n\nimport numpy as np\nimport pandas as pd\nimport statsmodels.formula.api as smf\nimport yaml\n\nRESULT_COLUMNS: List[str] = [\n    \"hypothesis_id\",\n    \"model\",\n    \"n_unweighted\",\n    \"n_weighted\",\n    \"estimate\",\n    \"se\",\n    \"ci_low\",\n    \"ci_high\",\n    \"p_value\",\n    \"q_value\",\n    \"effect_size_metric\",\n    \"robustness_passed\",\n    \"limitations\",\n    \"confidence_rating\",\n    \"analysis_timestamp\",\n    \"seed\",\n]\n\n\ndef _needs_quote(name: str) -> bool:\n    return not re.match(r\"^[A-Za-z_][A-Za-z0-9_]*$\", name)\n\n\ndef _quote(name: str) -> str:\n    return f'Q(\"{name}\")'\n\n\n@dataclass(frozen=True)\nclass HypothesisSpec:\n    hypothesis_id: str\n    outcome: str\n    predictor: str\n    controls: Sequence[str]\n    estimand: str\n    effect_size_metric: str\n    model_label: str\n\n    def required_columns(self) -> List[str]:\n        return [self.outcome, self.predictor, *self.controls]\n\n    def formula(self) -> str:\n        lhs = _quote(self.outcome)\n        tokens = [self.predictor if not _needs_quote(self.predictor) else _quote(self.predictor)]\n        for control in self.controls:\n            tokens.append(control if not _needs_quote(control) else _quote(control))\n        rhs = \" + \".join(tokens)\n        return f\"{lhs} ~ {rhs}\"\n\n    def predictor_term(self) -> str:\n        return self.predictor if not _needs_quote(self.predictor) else _quote(self.predictor)\n\n\nHYPOTHESES: Dict[str, HypothesisSpec] = {\n    \"HYP-001\": HypothesisSpec(\n        hypothesis_id=\"HYP-001\",\n        outcome=\"I love myself (2l8994l)\",\n        predictor=\"classchild\",\n        controls=[\"selfage\", \"gendermale\", \"cis\"],\n        estimand=\"Slope of childhood class predicting self-love\",\n        effect_size_metric=\"slope_per_unit\",\n        model_label=\"ols_hc3_srs\",\n    ),\n    \"HYP-003\": HypothesisSpec(\n        hypothesis_id=\"HYP-003\",\n        outcome=\"I tend to suffer from anxiety (npvfh98)-neg\",\n        predictor=\"CSA_score_indicator\",\n        controls=[\"selfage\", \"gendermale\", \"classchild\"],\n        estimand=\"Mean difference in anxiety for any CSA exposure\",\n        effect_size_metric=\"difference_in_means\",\n        model_label=\"ols_hc3_srs\",\n    ),\n}\n\n\ndef parse_args() -> argparse.Namespace:\n    parser = argparse.ArgumentParser(\n        description=\"Run pre-registered confirmatory models under SRS assumptions.\"\n    )\n    parser.add_argument(\n        \"--dataset\",\n        default=\"data/clean/childhoodbalancedpublic_with_csa_indicator.csv\",\n        help=\"Input dataset with derived variables.\",\n    )\n    parser.add_argument(\n        \"--config\",\n        default=\"config/agent_config.yaml\",\n        help=\"YAML config containing global seed and defaults.\",\n    )\n    parser.add_argument(\n        \"--survey-design\",\n        default=\"docs/survey_design.yaml\",\n        help=\"Survey design metadata (documenting SRS assumption).\",\n    )\n    parser.add_argument(\n        \"--hypotheses\",\n        nargs=\"+\",\n        default=list(HYPOTHESES.keys()),\n        help=\"Hypothesis IDs to evaluate (default: all registered confirmatory hypotheses).\",\n    )\n    parser.add_argument(\n        \"--results-csv\",\n        default=\"analysis/results.csv\",\n        help=\"Path to results CSV to create/update.\",\n    )\n    parser.add_argument(\n        \"--overwrite\",\n        action=\"store_true\",\n        help=\"Overwrite any existing rows for the targeted hypotheses instead of updating in place.\",\n    )\n    parser.add_argument(\n        \"--log-level\",\n        default=\"INFO\",\n        help=\"Logging level (DEBUG, INFO, WARNING, ERROR).\",\n    )\n    return parser.parse_args()\n\n\ndef load_config(path: Path) -> Dict:\n    with path.open(\"r\", encoding=\"utf-8\") as fh:\n        config = yaml.safe_load(fh)\n    return config or {}\n\n\ndef configure_logging(level: str) -> None:\n    logging.basicConfig(\n        level=getattr(logging, level.upper(), logging.INFO),\n        format=\"%(asctime)s %(levelname)s %(message)s\",\n    )\n\n\ndef seed_everything(seed: int) -> None:\n    random.seed(seed)\n    np.random.seed(seed)\n\n\ndef load_dataset(dataset_path: Path, required_columns: Iterable[str]) -> pd.DataFrame:\n    if dataset_path.suffix.lower() == \".csv\":\n        df = pd.read_csv(dataset_path)\n    elif dataset_path.suffix.lower() in {\".parquet\", \".pq\"}:\n        df = pd.read_parquet(dataset_path)\n    else:\n        raise ValueError(f\"Unsupported dataset format: {dataset_path.suffix}\")\n\n    missing = [col for col in required_columns if col not in df.columns]\n    if missing:\n        raise KeyError(f\"Dataset missing required columns: {missing}\")\n    return df\n\n\ndef run_model_for_spec(df: pd.DataFrame, spec: HypothesisSpec) -> Dict[str, object]:\n    logging.info(\"Running model for %s\", spec.hypothesis_id)\n\n    subset = df.loc[:, spec.required_columns()].copy()\n    before_drop = len(subset)\n    subset = subset.dropna()\n    dropped = before_drop - len(subset)\n    if dropped:\n        logging.info(\n            \"Dropped %d rows with missing data for %s (%.2f%% of subset).\",\n            dropped,\n            spec.hypothesis_id,\n            dropped / before_drop * 100 if before_drop else 0,\n        )\n\n    if subset.empty:\n        raise ValueError(f\"No rows remain after dropna for {spec.hypothesis_id}.\")\n\n    formula = spec.formula()\n    model = smf.ols(formula=formula, data=subset)\n    fitted = model.fit()\n    robust = fitted.get_robustcov_results(cov_type=\"HC3\")\n\n    term = spec.predictor_term()\n    exog_names = list(robust.model.exog_names)\n    params = pd.Series(robust.params, index=exog_names)\n    bse = pd.Series(robust.bse, index=exog_names)\n    conf_int = pd.DataFrame(\n        robust.conf_int(alpha=0.05),\n        index=exog_names,\n        columns=[\"ci_low\", \"ci_high\"],\n    )\n    pvalues = pd.Series(robust.pvalues, index=exog_names)\n\n    estimate = params[term]\n    se = bse[term]\n    ci_low = conf_int.loc[term, \"ci_low\"]\n    ci_high = conf_int.loc[term, \"ci_high\"]\n    p_value = pvalues[term]\n\n    n_unweighted = len(subset)\n\n    result = {\n        \"hypothesis_id\": spec.hypothesis_id,\n        \"model\": spec.model_label,\n        \"n_unweighted\": n_unweighted,\n        \"n_weighted\": float(n_unweighted),\n        \"estimate\": float(estimate),\n        \"se\": float(se),\n        \"ci_low\": float(ci_low),\n        \"ci_high\": float(ci_high),\n        \"p_value\": float(p_value),\n        \"q_value\": None,\n        \"effect_size_metric\": spec.effect_size_metric,\n        \"robustness_passed\": \"N\",\n        \"limitations\": \"\",\n        \"confidence_rating\": \"Pending\",\n    }\n    return result\n\n\ndef update_results_csv(results_csv: Path, rows: List[Dict[str, object]], seed: int, overwrite: bool) -> None:\n    timestamp = datetime.now(tz=timezone.utc).isoformat()\n    df_new = pd.DataFrame(rows)\n    df_new[\"analysis_timestamp\"] = timestamp\n    df_new[\"seed\"] = seed\n\n    if results_csv.exists():\n        existing = pd.read_csv(results_csv)\n    else:\n        existing = pd.DataFrame(columns=RESULT_COLUMNS)\n\n    existing = existing[[c for c in existing.columns if c in RESULT_COLUMNS]]\n\n    if overwrite:\n        existing = existing[~existing[\"hypothesis_id\"].isin(df_new[\"hypothesis_id\"])]\n    else:\n        mask = existing[\"hypothesis_id\"].isin(df_new[\"hypothesis_id\"])\n        existing = existing[~mask]\n\n    combined = pd.concat([existing, df_new], ignore_index=True)\n    combined = combined[RESULT_COLUMNS]\n    combined.sort_values(by=\"hypothesis_id\", inplace=True)\n    results_csv.parent.mkdir(parents=True, exist_ok=True)\n    combined.to_csv(results_csv, index=False)\n    logging.info(\"Wrote results to %s\", results_csv)\n\n\ndef validate_design_assumption(survey_design_path: Path) -> None:\n    if not survey_design_path.exists():\n        raise FileNotFoundError(\n            f\"Survey design file {survey_design_path} is required to document SRS assumption.\"\n        )\n    with survey_design_path.open(\"r\", encoding=\"utf-8\") as fh:\n        design = yaml.safe_load(fh)\n    assumed = design.get(\"assumed_design\")\n    if assumed != \"simple_random_sampling\":\n        raise ValueError(\n            \"Confirmatory models currently implemented only for simple random sampling. \"\n            f\"Found assumed_design={assumed!r}.\"\n        )\n\n\ndef main() -> None:\n    args = parse_args()\n    configure_logging(args.log_level)\n\n    config = load_config(Path(args.config))\n    seed = int(config.get(\"seed\", 0) or 0)\n    if seed <= 0:\n        raise ValueError(\"Global seed must be a positive integer in config/agent_config.yaml.\")\n    seed_everything(seed)\n    logging.info(\"Global seed set to %d\", seed)\n\n    validate_design_assumption(Path(args.survey_design))\n\n    requested = args.hypotheses\n    unknown = [hyp for hyp in requested if hyp not in HYPOTHESES]\n    if unknown:\n        raise KeyError(f\"Hypotheses not registered in confirmatory registry: {unknown}\")\n\n    specs = [HYPOTHESES[hyp] for hyp in requested]\n    required_columns = sorted({col for spec in specs for col in spec.required_columns()})\n    df = load_dataset(Path(args.dataset), required_columns)\n\n    results: List[Dict[str, object]] = []\n    for spec in specs:\n        row = run_model_for_spec(df, spec)\n        results.append(row)\n\n    update_results_csv(Path(args.results_csv), results, seed=seed, overwrite=args.overwrite)\n\n\nif __name__ == \"__main__\":\n    main()\n",
      "mode": "text"
    },
    {
      "path": "analysis/results.csv",
      "content": "hypothesis_id,model,n_unweighted,n_weighted,estimate,se,ci_low,ci_high,p_value,q_value,effect_size_metric,robustness_passed,limitations,confidence_rating,analysis_timestamp,seed\nHYP-001,ols_hc3_srs,14436,14436.0,0.1811858897013576,0.0119976321290332,0.1576689904092998,0.2047027889934154,3.873525838182848e-51,3.873525838182848e-51,slope_per_unit,N,,Pending,2025-11-04T10:17:40.902935+00:00,20251016.0\nHYP-003,ols_hc3_srs,14437,14437.0,-0.4905027134735744,0.0365181179096809,-0.5620829125486829,-0.4189225143984658,6.933341034253467e-41,6.933341034253467e-41,difference_in_means,N,,Pending,2025-11-04T10:17:40.902935+00:00,20251016.0\n",
      "mode": "text"
    },
    {
      "path": "tables/fdr_adjustment_confirmatory.csv",
      "content": "family,hypothesis_id,p_value,q_value,rank_within_family,seed\nWellbeing,HYP-001,3.873525838182848e-51,3.873525838182848e-51,1,20251016\nMentalHealth,HYP-003,6.933341034253467e-41,6.933341034253467e-41,1,20251016\n",
      "mode": "text"
    },
    {
      "path": "analysis/decision_log.csv",
      "content": "ts,action,inputs,rationale_short,code_path,outputs,status\n2025-11-03T20:01:43Z,bootstrap,docs/codebook.json;docs/survey_design.yaml;config/agent_config.yaml,\"Initialized bootstrap scaffolding, hypotheses, PAP draft, and regen script.\",N/A,artifacts/state.json;analysis/hypotheses.csv;analysis/pre_analysis_plan.md,success\n2025-11-03T20:18:32Z,validate_design,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,\"Confirmed no survey weights; default to SRS.\",analysis/code/validate_survey_design.py,docs/survey_design.yaml;qc/survey_design_validation.md,success\n2025-11-03T20:23:05Z,regen_design,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,\"Regenerated design artifacts after script refactor.\",analysis/code/validate_survey_design.py,docs/survey_design.yaml;qc/survey_design_validation.md,success\n2025-11-03T20:24:59Z,regen_design,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,\"Refined validation script for leaner reproducibility footprint.\",analysis/code/validate_survey_design.py,docs/survey_design.yaml;qc/survey_design_validation.md,success\n2025-11-03T20:26:59Z,regen_design,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,\"Re-executed lean validation script to refresh artifacts.\",analysis/code/validate_survey_design.py,docs/survey_design.yaml;qc/survey_design_validation.md,success\n2025-11-03T20:29:10Z,regen_design,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,\"Compressed validation script and refreshed outputs.\",analysis/code/validate_survey_design.py,docs/survey_design.yaml;qc/survey_design_validation.md,success\n2025-11-03T20:29:10Z,regen_design,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,Compressed validation script and refreshed outputs.,analysis/code/validate_survey_design.py,docs/survey_design.yaml;qc/survey_design_validation.md,success\n2025-11-03T20:34:14Z,exploratory_summary,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,\"Generated exploratory outcome summaries under SRS.\",analysis/code/eda_weighted_summaries.py,tables/exploratory_outcome_summary.csv;tables/exploratory_outcome_distribution.csv,success\n2025-11-03T20:34:14Z,exploratory_summary,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,Generated exploratory outcome summaries under SRS.,analysis/code/eda_weighted_summaries.py,tables/exploratory_outcome_summary.csv;tables/exploratory_outcome_distribution.csv,success\n2025-11-03T20:44:20Z,schema_alignment,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,Regenerated codebook schema with suppressed small cells.,analysis/code/align_codebook_schema.py,docs/codebook.json;qc/schema_alignment.md,success\n2025-11-03T20:47:13Z,schema_alignment,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,Trimmed published frequencies to limit sparse tail disclosure.,analysis/code/align_codebook_schema.py,docs/codebook.json;qc/schema_alignment.md,success\n2025-11-03T20:48:21Z,schema_alignment,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,Refreshed codebook notes to current timestamp.,analysis/code/align_codebook_schema.py,docs/codebook.json;qc/schema_alignment.md,success\n2025-11-03T20:50:32Z,schema_alignment,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,Streamlined codebook to summary-only metadata for disclosure control.,analysis/code/align_codebook_schema.py,docs/codebook.json;qc/schema_alignment.md,success\n2025-11-03T20:50:32Z,schema_alignment,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml,Streamlined codebook to summary-only metadata for disclosure control.,analysis/code/align_codebook_schema.py,docs/codebook.json;qc/schema_alignment.md,success\n2025-11-03T20:56:41Z,missingness_profile,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml;analysis/hypotheses.csv,\"Profiled hypothesis missingness; suppressed <10 cells.\",analysis/code/profile_missingness.py,tables/missingness_profile.csv;tables/missingness_patterns.csv;tables/missingness_profile.meta.json,success\n2025-11-03T20:56:41Z,missingness_profile,childhoodbalancedpublic_original.csv;docs/codebook.json;config/agent_config.yaml;analysis/hypotheses.csv,Profiled hypothesis missingness; suppressed <10 cells.,analysis/code/profile_missingness.py,tables/missingness_profile.csv;tables/missingness_patterns.csv;tables/missingness_profile.meta.json,success\n2025-11-03T21:06:24Z,derive_csa_indicator,data/raw/childhoodbalancedpublic_original.csv;config/agent_config.yaml;docs/codebook.json;analysis/pre_analysis_plan.md,Derived CSA indicator and expanded robustness plans.,analysis/code/derive_csa_indicator.py,data/clean/childhoodbalancedpublic_with_csa_indicator.csv;tables/csa_indicator_distribution.csv;docs/codebook.json;analysis/pre_analysis_plan.md;analysis/hypotheses.csv;notebooks/research_notebook.md;qc/data_checks.md,success\n2025-11-03T21:06:24Z,derive_csa_indicator,data/raw/childhoodbalancedpublic_original.csv;config/agent_config.yaml;docs/codebook.json;analysis/pre_analysis_plan.md,Derived CSA indicator and expanded robustness plans.,analysis/code/derive_csa_indicator.py,data/clean/childhoodbalancedpublic_with_csa_indicator.csv;tables/csa_indicator_distribution.csv;docs/codebook.json;analysis/pre_analysis_plan.md;analysis/hypotheses.csv;notebooks/research_notebook.md;qc/data_checks.md,success\n2025-11-03T21:35:00Z,support_feasibility,data/clean/childhoodbalancedpublic_with_csa_indicator.csv;config/agent_config.yaml,Profiled social support coverage; recommended alternate item.,analysis/code/social_support_missingness.py,tables/social_support_missingness.csv;qc/social_support_feasibility.md;analysis/hypotheses.csv;notebooks/research_notebook.md;artifacts/state.json,success\n2025-11-03T22:05:00Z,instrument_equivalence,data/clean/childhoodbalancedpublic_with_csa_indicator.csv;config/agent_config.yaml;docs/codebook.json;analysis/hypotheses.csv,\"Verified social-support instrument alignment and pivoted predictor to 71mn55g.\",analysis/code/verify_social_support_equivalence.py,tables/social_support_equivalence_summary.csv;tables/social_support_equivalence_distributions.csv;tables/social_support_instrument_overlap.csv;qc/social_support_equivalence.md;docs/codebook.json;analysis/hypotheses.csv;analysis/pre_analysis_plan.md;notebooks/research_notebook.md;artifacts/state.json,success\n2025-11-03T22:45:00Z,confirmatory_model_skeleton,data/clean/childhoodbalancedpublic_with_csa_indicator.csv;config/agent_config.yaml;docs/survey_design.yaml;analysis/hypotheses.csv;analysis/pre_analysis_plan.md,\"Drafted confirmatory OLS skeleton and updated PAP for freeze readiness.\",analysis/code/confirmatory_models.py,analysis/code/confirmatory_models.py;analysis/pre_analysis_plan.md;analysis/hypotheses.csv;notebooks/research_notebook.md;artifacts/state.json,success\n2025-11-03T22:45:00Z,confirmatory_model_skeleton,data/clean/childhoodbalancedpublic_with_csa_indicator.csv;config/agent_config.yaml;docs/survey_design.yaml;analysis/hypotheses.csv;analysis/pre_analysis_plan.md,Drafted confirmatory OLS skeleton and updated PAP for freeze readiness.,analysis/code/confirmatory_models.py,analysis/code/confirmatory_models.py;analysis/pre_analysis_plan.md;analysis/hypotheses.csv;notebooks/research_notebook.md;artifacts/state.json,success\n2025-11-04T10:06:30Z,pap_freeze,analysis/pre_analysis_plan.md;papers/main/MANIFEST.md;config/agent_config.yaml;analysis/code/update_repro_checkpoints.py,Froze PAP and refreshed reproducibility checkpoints.,analysis/code/update_repro_checkpoints.py,analysis/pre_analysis_plan.md;papers/main/MANIFEST.md;artifacts/session_info.txt;artifacts/checksums.json;notebooks/research_notebook.md;analysis/code/update_repro_checkpoints.py,success\n2025-11-04T10:06:30Z,pap_freeze,analysis/pre_analysis_plan.md;papers/main/MANIFEST.md;config/agent_config.yaml;analysis/code/update_repro_checkpoints.py,Froze PAP and refreshed reproducibility checkpoints.,analysis/code/update_repro_checkpoints.py,analysis/pre_analysis_plan.md;papers/main/MANIFEST.md;artifacts/session_info.txt;artifacts/checksums.json;notebooks/research_notebook.md;analysis/code/update_repro_checkpoints.py,success\n2025-11-04T10:19:29+00:00,confirmatory_analysis,data/clean/childhoodbalancedpublic_with_csa_indicator.csv;config/agent_config.yaml;docs/survey_design.yaml;analysis/code/confirmatory_models.py,Fixed HC3 parameter indexing and executed PAP OLS for HYP-001/003 (seed 20251016).,analysis/code/confirmatory_models.py,analysis/results.csv;analysis/code/confirmatory_models.py,success\n2025-11-04T10:19:29+00:00,fdr_adjustment,analysis/results.csv;analysis/hypotheses.csv;config/agent_config.yaml,Applied Benjamini-Hochberg q-values to confirmatory hypotheses.,analysis/code/fdr_adjust.py,analysis/results.csv;tables/fdr_adjustment_confirmatory.csv,success\n",
      "mode": "text"
    },
    {
      "path": "notebooks/research_notebook.md",
      "content": "# Research Notebook\nUpdated: 2025-11-04T10:19:29Z | Seed: 20251016\n\nReproducibility: run `python analysis/code/bootstrap_setup.py`; env info in `artifacts/session_info.txt`; checksums in `artifacts/checksums.json`.\n\nHypotheses: HYP-001 childhood class ↑ self-love; HYP-002 current class ↓ depression; HYP-003 CSA ↑ anxiety; HYP-004 support ↑ self-love.\n\n2025-11-03T20:29Z — Survey design validation confirms no sampling weights/strata/clusters present in `childhoodbalancedpublic_original.csv`; working under simple random sampling assumption. See `qc/survey_design_validation.md` regenerated via `python analysis/code/validate_survey_design.py`.\n\n2025-11-03T20:34Z (Exploratory) — Generated outcome distributions under SRS assumption via\\\n `python analysis/code/eda_weighted_summaries.py --dataset childhoodbalancedpublic_original.csv --codebook docs/codebook.json --config config/agent_config.yaml --out-summary tables/exploratory_outcome_summary.csv --out-distribution tables/exploratory_outcome_distribution.csv`.\\\n Key findings: self-love skews positive (median=1), while depression/anxiety skew negative (median -1). All categories exceed the small-cell threshold (10). Outputs: `tables/exploratory_outcome_summary.csv`, `tables/exploratory_outcome_distribution.csv`.\n\nTODO: document literature and exploratory findings (labelled \"Exploratory\"); derive CSA indicator prior to PAP freeze. Prepare `papers/main/MANIFEST.md` when manuscript drafting begins.\n\n2025-11-03T20:50Z — Schema alignment completed via \\\n`python analysis/code/align_codebook_schema.py --dataset childhoodbalancedpublic_original.csv --codebook-in docs/codebook.json --codebook-out docs/codebook.json`.\\\nValidated storage types, allowed ranges, and missingness for six analysis variables; suppressed small cells (<10) and now omit detailed frequency tables to avoid sparse tail disclosure. Details recorded in `qc/schema_alignment.md`.\n\n2025-11-03T20:56Z (QC) — Profiled hypothesis-relevant missingness via \\\n`python analysis/code/profile_missingness.py --dataset childhoodbalancedpublic_original.csv --codebook docs/codebook.json --hypotheses analysis/hypotheses.csv --config config/agent_config.yaml --out-csv tables/missingness_profile.csv --out-patterns tables/missingness_patterns.csv`.\\\n Suppressed cell counts <10; see `tables/missingness_profile.csv` (+ `.meta.json`) and `tables/missingness_patterns.csv`. Social support predictor `In general, people in my *current* social circles tend treat me really well (tmt46e6)` exhibits 97.35% missingness—flagged for feasibility review. At that point `CSA_score_indicator` was absent in raw data, motivating derivation task T-006 prior to PAP freeze.\n\n2025-11-03T21:05Z (Derived) — Established canonical data folders (`data/raw`, `data/clean`) and derived CSA exposure indicator via \\\n`python analysis/code/derive_csa_indicator.py --dataset data/raw/childhoodbalancedpublic_original.csv --out-dataset data/clean/childhoodbalancedpublic_with_csa_indicator.csv --out-distribution tables/csa_indicator_distribution.csv --config config/agent_config.yaml --codebook-in docs/codebook.json --codebook-out docs/codebook.json`.\\\nOutput dataset stored at `data/clean/childhoodbalancedpublic_with_csa_indicator.csv`; distribution table `tables/csa_indicator_distribution.csv` confirms 22.31% report any CSA (no cells <10). Updated `docs/codebook.json` with new binary predictor metadata and refreshed `artifacts/checksums.json`. PAP robustness section expanded for HYP-001/HYP-003 (see `analysis/pre_analysis_plan.md`).\n\n2025-11-03T21:35Z (Exploratory) — Assessed feasibility of the social support predictor for HYP-004 via \\\n`python analysis/code/social_support_missingness.py --dataset data/clean/childhoodbalancedpublic_with_csa_indicator.csv --out-csv tables/social_support_missingness.csv --config config/agent_config.yaml`.\\\n Key finding: original item (`...tend treat me really well (tmt46e6)`) covers only 383 respondents (97.35% missing), while an instrument twin (`...tend to treat me really well (71mn55g)`) covers 14,054 respondents. Responses do not overlap, suggesting form-version routing. Recommendation logged in `qc/social_support_feasibility.md` to pivot HYP-004 to the high-coverage item pending instrument confirmation.\n\n2025-11-03T22:05Z (QC) — Verified instrument equivalence across the tmt46e6 and 71mn55g social-support items via \\\n`python analysis/code/verify_social_support_equivalence.py --dataset data/clean/childhoodbalancedpublic_with_csa_indicator.csv --out-summary tables/social_support_equivalence_summary.csv --out-distribution tables/social_support_equivalence_distributions.csv --out-overlap tables/social_support_instrument_overlap.csv --config config/agent_config.yaml --columns \"In general, people in my *current* social circles tend treat me really well (tmt46e6)\" \"In general, people in my *current* social circles tend to treat me really well (71mn55g)\"`.\\\n Findings: identical 7-point scales (−3 to +3), shared prompt wording apart from insertion of “to,” and mutually exclusive routing (no respondents with both non-missing). Distribution tables suppress cells <10 as required. Documented evidence in `qc/social_support_equivalence.md`; updated codebook and hypothesis registry to pivot HYP-004 to instrument 71mn55g.\n\n2025-11-03T22:45Z (Planning) — Drafted confirmatory model equations and executable skeleton via \\\n`python analysis/code/confirmatory_models.py --dataset data/clean/childhoodbalancedpublic_with_csa_indicator.csv --config config/agent_config.yaml --survey-design docs/survey_design.yaml --hypotheses HYP-001 HYP-003 --results-csv analysis/results.csv --overwrite`.\\\n Outcome: PAP now records explicit model statements for HYP-001 and HYP-003, and hypothesis registry flags them `in_PAP`. The script writes deterministic HC3 OLS outputs seeded at 20251016 and will feed `analysis/results.csv` post-freeze. Next step: freeze PAP and tag commit prior to confirmatory execution.\n\n2025-11-04T10:06Z (Checkpoint) — Froze PAP (`analysis/pre_analysis_plan.md`) for HYP-001 & HYP-003 after confirming code paths and SRS rationale; logged regeneration commands and seed usage. Refreshed reproducibility checkpoints with \\\n`python analysis/code/update_repro_checkpoints.py --config config/agent_config.yaml --data data/raw/childhoodbalancedpublic_original.csv --data data/clean/childhoodbalancedpublic_with_csa_indicator.csv`, producing updated `artifacts/session_info.txt` and `artifacts/checksums.json`. `papers/main/MANIFEST.md` now references the frozen timestamp and queued commands for FDR and robustness scripts. Next actions: execute confirmatory models per frozen command, then apply FDR and robustness pipeline.\n\n2025-11-04T10:17Z (Confirmatory) — Patched `analysis/code/confirmatory_models.py` to align HC3 outputs with labeled exogenous names, then executed the frozen command: \\\n`python analysis/code/confirmatory_models.py --dataset data/clean/childhoodbalancedpublic_with_csa_indicator.csv --config config/agent_config.yaml --survey-design docs/survey_design.yaml --results-csv analysis/results.csv --hypotheses HYP-001 HYP-003 --overwrite`. \\\nOutputs: `analysis/results.csv` (timestamp 2025-11-04T10:17:40Z) with HC3 OLS coefficients for HYP-001 (β = 0.181, SE = 0.012) and HYP-003 (β = −0.491, SE = 0.037); seed 20251016 logged in-file. Pending robustness checks remain flagged `N`.\n\n2025-11-04T10:18Z (Adjustment) — Applied Benjamini–Hochberg corrections via \\\n`python analysis/code/fdr_adjust.py --results analysis/results.csv --hypotheses analysis/hypotheses.csv --config config/agent_config.yaml --family-scope confirmatory --audit-table tables/fdr_adjustment_confirmatory.csv`. \\\n`analysis/results.csv` now records q-values (equal to p due to two-test family), and `tables/fdr_adjustment_confirmatory.csv` archives the BH audit trace. Robustness automation remains queued (Task T-011 follow-up).\n",
      "mode": "text"
    },
    {
      "path": "reports/findings_v0.3.md",
      "content": "# Findings Report v0.3\nVersion: 0.3.0 (literature contextualization)  \nUpdated: 2025-11-04T11:19Z | Seed: 20251016\n\n> **Parity requirement:** Keep this Markdown report in sync with `papers/main/manuscript.tex`. Any change here must be mirrored in LaTeX during the same commit.\n\n## Changelog\n- Added peer-reviewed literature synthesis to contextualize the CSA-anxiety finding.\n- Logged Semantic Scholar query outputs under `lit/queries/` for reproducibility.\n- Updated evidence map and bibliography to replace bootstrap placeholders.\n- Executed CSA × gender DIF diagnostic for the anxiety item and archived outputs.\n- Patched confirmatory HC3 extraction to preserve label indexing and re-ran PAP models with BH audit table archived.\n\n## Abstract\nConfirmatory analyses (n = 14,436) indicate that each one-step increase in childhood class corresponds to a 0.18-point rise in adult self-love on the 7-point agreement scale (95% CI [0.16, 0.20], q approx 3.9e-51), roughly 0.10 standard deviations. Contrary to the preregistered direction, respondents reporting any childhood sexual abuse agreement average 0.49 points lower on the anxiety agreement scale (95% CI [-0.56, -0.42], q approx 6.9e-41), about a quarter of a standard deviation. All estimates rely on HC3 OLS under a simple random sampling assumption and are reproducible with seed 20251016.\n\n## Methods\n- Data source: `data/raw/childhoodbalancedpublic_original.csv` (SHA-256 logged in `artifacts/checksums.json`).\n- Derived dataset: `data/clean/childhoodbalancedpublic_with_csa_indicator.csv` regenerated via  \n  `python analysis/code/derive_csa_indicator.py --dataset data/raw/childhoodbalancedpublic_original.csv --out-dataset data/clean/childhoodbalancedpublic_with_csa_indicator.csv --out-distribution tables/csa_indicator_distribution.csv --config config/agent_config.yaml --codebook-in docs/codebook.json --codebook-out docs/codebook.json`.\n- Confirmatory scope: HYP-001 and HYP-003 (see `analysis/pre_analysis_plan.md`, frozen 2025-11-04T07:58:50Z).\n- Statistical plan: HC3 OLS under SRS assumption; Benjamini-Hochberg at q=0.05 within confirmatory family; robustness checks pre-specified in the PAP.\n\n## Results\n- **HYP-001 (Wellbeing family)**: Childhood class exhibits a positive association with adult self-love (beta = 0.181, SE = 0.012; 95% CI [0.158, 0.205]; q = 3.9e-51). Interpreted against the outcome's SD (1.86), the estimate equals approx0.10 SD and implies ~0.5-point difference when comparing individuals three class steps apart, holding age, gender, and cis identity constant.\n- **HYP-003 (MentalHealth family)**: Any CSA exposure is linked to -0.491 points on the anxiety agreement scale (SE = 0.037; 95% CI [-0.562, -0.419]; q = 6.9e-41). Because the negative-coded outcome maps higher agreement to positive values, the negative coefficient means CSA-exposed respondents report *lower* agreement with \"I tend to suffer from anxiety,\" opposite to the preregistered expectation of higher anxiety.\n\nBenjamini-Hochberg adjustments (q = 0.05 family-wise) do not alter inference because the extremely small p-values remain far below the threshold.\n\n## Robustness and Sensitivity\n- **HYP-001**: Treating childhood class as categorical with Helmert contrasts yields an average class effect of 0.07 (F = 89.7). An ordinal logit specification reports a log-odds coefficient of 0.17 (p approx 7.3e-48), and z-scoring the outcome produces beta = 0.097 (p approx 1.6e-51). All checks retain the positive direction and comparable magnitudes.\n- **HYP-003**: A logistic model contrasting high anxiety agreement (>= 1) produces an odds ratio of 0.57 (95% CI approx [0.51, 0.64]). Binning CSA intensity into 0/1-3/4+ bins and trimming the CSA >15 tail both keep negative associations (beta_bins = -0.33; trimmed beta = -0.48), corroborating the observed direction despite diverging from the preregistered expectation. An ordinal-logit DIF test with CSA, gender, and their interaction reports no detectable CSA × gender interaction (χ²(1) = 0.24, p = 0.625), mitigating concerns about gender-linked measurement artifacts.\n\n## Interpretation and Context\nChildhood class effects appear modest in absolute scale units but align with roughly a tenth of the variability in the self-love measure. Meta-analytic work consistently links childhood sexual abuse to elevated anxiety and related psychopathology (Lindert et al., 2014; Hashim et al., 2024), and symptom network analysis among CSA survivors highlights worry and restlessness as central nodes (Li et al., 2023). The present negative coefficient therefore likely reflects measurement or reporting dynamics rather than a true protective effect. Potential explanations include (1) the agreement scale framing (\"I tend to suffer from anxiety\") eliciting stigma-driven disagreement among trauma survivors, (2) unmeasured treatment uptake reducing current anxiety symptoms despite historical CSA exposure, and (3) sample composition differences relative to clinical and adolescent cohorts emphasized in the literature. The absence of CSA × gender DIF in the ordinal-logit diagnostic suggests the anomaly is unlikely to stem from gender-specific reporting bias. Pending follow-up diagnostics (T-016) will probe scale direction and subgroup heterogeneity before drawing substantive conclusions.\n\n## Limitations\n1. Survey provider has not confirmed the absence of design weights; we proceed under a simple random sampling assumption and flag potential bias from undisclosed complex design features.\n2. Both outcomes are ordinal but modeled as interval variables; effect magnitudes should be interpreted as approximate.\n3. CSA exposure is derived from a composite score, and its association with lower anxiety agreement suggests possible measurement or reporting artifacts that merit qualitative follow-up.\n\n## Ethics, Privacy, and Disclosure\n- Small-cell suppression threshold: n < 10 (per `config/agent_config.yaml`); adhere to rounding/binning in all outputs.\n- Data contain sensitive childhood trauma indicators; confirm IRB posture before dissemination.\n\n## Open Questions\n1. Should HYP-004 (social support) advance to confirmatory status once routing documentation is secured?\n2. Does the negative CSA-anxiety association stem from coding (negative vs. positive framing), sample composition, or differential nonresponse requiring additional weighting or qualitative context?\n\n## Reproducibility Notes\n- Environment snapshot: `artifacts/session_info.txt`.\n- Seed: `artifacts/seed.txt` (20251016).\n- Regeneration commands:  \n  - Confirmatory estimates: `python analysis/code/confirmatory_models.py --dataset data/clean/childhoodbalancedpublic_with_csa_indicator.csv --config config/agent_config.yaml --survey-design docs/survey_design.yaml --hypotheses HYP-001 HYP-003 --results-csv analysis/results.csv --overwrite`  \n  - FDR adjustment: `python analysis/code/fdr_adjust.py --results analysis/results.csv --hypotheses analysis/hypotheses.csv --config config/agent_config.yaml --family-scope confirmatory --audit-table tables/fdr_adjustment_confirmatory.csv`  \n  - Robustness checks: `python analysis/code/run_robustness_checks.py --dataset data/clean/childhoodbalancedpublic_with_csa_indicator.csv --config config/agent_config.yaml --qc-dir qc --tables-dir tables/robustness --hypotheses HYP-001 HYP-003`  \n  - Literature queries (respect 120 s throttle to avoid HTTP 429):  \n    `sleep 120 && curl -s 'https://api.semanticscholar.org/graph/v1/paper/search?query=childhood%20sexual%20abuse%20anxiety%20adult&limit=3&fields=title,authors,year,venue,url,journal,externalIds' > lit/queries/20251104_semanticscholar_csa_anxiety_adult.json`  \n    `sleep 120 && curl -s 'https://api.semanticscholar.org/graph/v1/paper/search?query=childhood%20sexual%20abuse%20anxiety%20depression%20network%20analysis&limit=1&fields=title,authors,year,venue,url,journal,externalIds,abstract' > lit/queries/20251104_semanticscholar_csa_anxiety_network.json`\n- Manual edits remain synchronized with `papers/main/manuscript.tex`; document any automated regeneration (e.g., via pandoc) in `papers/main/MANIFEST.md`.\n",
      "mode": "text"
    },
    {
      "path": "artifacts/state.json",
      "content": "{\n  \"backlog\": [\n    {\n      \"description\": \"Validate survey weights and replicate design\",\n      \"id\": \"T-001\",\n      \"priority\": 1,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Exploratory weighted summaries for key outcomes\",\n      \"id\": \"T-002\",\n      \"priority\": 1,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Align codebook schema with dataset\",\n      \"id\": \"T-003\",\n      \"priority\": 2,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Profile missingness patterns for key variables\",\n      \"id\": \"T-004\",\n      \"priority\": 2,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Draft robustness checks for priority hypotheses\",\n      \"id\": \"T-005\",\n      \"priority\": 3,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Derive CSA_score_indicator and validate distribution\",\n      \"id\": \"T-006\",\n      \"priority\": 2,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Assess feasibility of social support predictor given 97% missingness\",\n      \"id\": \"T-007\",\n      \"priority\": 2,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Draft confirmatory model equations/code skeleton for PAP freeze\",\n      \"id\": \"T-008\",\n      \"priority\": 3,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Verify instrument equivalence for social support items (tmt46e6 vs 71mn55g)\",\n      \"id\": \"T-009\",\n      \"priority\": 2,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Freeze PAP and tag reproducibility checkpoint\",\n      \"id\": \"T-010\",\n      \"priority\": 1,\n      \"status\": \"completed\"\n    },\n    {\n      \"description\": \"Plan FDR procedure and robustness execution scripts\",\n      \"id\": \"T-011\",\n      \"priority\": 2,\n      \"status\": \"in_progress\"\n    },\n    {\n      \"description\": \"Run confirmatory models for HYP-001 and HYP-003 per frozen PAP\",\n      \"id\": \"T-012\",\n      \"priority\": 1,\n      \"status\": \"completed\"\n    }\n  ],\n  \"bootstrap_complete\": true,\n  \"last_updated\": \"2025-11-04T10:20:30.098941+00:00\",\n  \"loop_counter\": 20,\n  \"next_actions\": [\n    {\n      \"description\": \"Plan FDR procedure and robustness execution scripts\",\n      \"id\": \"T-011\",\n      \"priority\": 2\n    }\n  ],\n  \"notes\": \"PAP frozen 2025-11-04T10:06Z; confirmatory HC3 OLS executed 2025-11-04T10:17Z with seed 20251016. FDR adjustment archived to tables/fdr_adjustment_confirmatory.csv. Next: finalize robustness automation per PAP and document outputs.\",\n  \"pap_status\": \"frozen\",\n  \"priority_hypotheses\": [\n    \"HYP-001\",\n    \"HYP-003\"\n  ],\n  \"seed\": 20251016,\n  \"total_loops\": 30\n}",
      "mode": "text"
    }
  ],
  "decision_log_row": {
    "ts": "2025-11-04T10:19:29+00:00",
    "action": "confirmatory_analysis",
    "inputs": [
      "data/clean/childhoodbalancedpublic_with_csa_indicator.csv",
      "config/agent_config.yaml",
      "docs/survey_design.yaml",
      "analysis/code/confirmatory_models.py"
    ],
    "rationale_short": "Fixed HC3 parameter indexing and executed PAP OLS for HYP-001/003 (seed 20251016).",
    "code_path": "analysis/code/confirmatory_models.py",
    "outputs": [
      "analysis/results.csv",
      "analysis/code/confirmatory_models.py"
    ],
    "status": "success"
  },
  "next_actions": [
    {
      "id": "T-011",
      "priority": 2,
      "desc": "Finalize robustness execution scripts and run preregistered checks for HYP-001/HYP-003",
      "estimate_min": "30m"
    }
  ],
  "state_update": {
    "loop_counter": 20
  },
  "git": {
    "commit": true,
    "message": "feat(confirmatory): run PAP models and adjust FDR"
  },
  "stop_now": false,
  "stop_reason": "",
  "signals": []
}
```